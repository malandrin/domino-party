(function(t){function e(e){for(var s,o,r=e[0],l=e[1],c=e[2],d=0,u=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&u.push(a[o][0]),a[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);h&&h(e);while(u.length)u.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,r=1;r<i.length;r++){var l=i[r];0!==a[l]&&(s=!1)}s&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var s={},a={app:0},n=[];function o(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=s,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(i,s,function(e){return t[e]}.bind(null,s));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/domino-party/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var h=l;n.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"06d2":function(t,e,i){"use strict";var s=i("a61f"),a=i.n(s);a.a},1:function(t,e){},3457:function(t,e,i){},"359c":function(t,e,i){t.exports=i.p+"img/github.4b0019a6.png"},3844:function(t,e,i){"use strict";var s=i("a9a4"),a=i.n(s);a.a},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),a=i("28dd"),n=i("760d"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},r=[],l={name:"App"},c=l,h=(i("fffb7"),i("2877")),d=Object(h["a"])(c,o,r,!1,null,null,null),u=d.exports,f=i("8c4f"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("div",{staticClass:"title"},[t._v("Welcome to Domino Party")]),s("div",{staticClass:"message"},[t._v("What do you want to do today?")]),s("div",{staticClass:"options"},[s("div",{staticClass:"option",on:{click:function(e){return t.gotoPage("create")}}},[s("div",{staticClass:"title"},[t._v("Create")]),s("img",{staticClass:"capture",attrs:{src:i("bc73")}}),s("div",{staticClass:"description"},[t._v("You have one square meter board. Use the editor to populate it with domino tiles and share it with the world. The only requirement is: the last tile must fall.")])]),s("div",{staticClass:"option",on:{click:function(e){return t.gotoPage("view")}}},[s("div",{staticClass:"title"},[t._v("View")]),s("img",{staticClass:"capture",attrs:{src:i("cbbe")}}),s("div",{staticClass:"description"},[t._v("Relax and enjoy watching other users creations put one after other creating an infinite tiles falling stream.")])])]),s("div",{staticClass:"footer"},[t._m(0),s("div",{style:{"margin-left":"auto"}},[t._v(" Source code available at GitHub "),s("a",{attrs:{href:"https://github.com/malandrin/domino-party"}},[s("img",{staticClass:"githubImage",style:{"margin-left":"10px"},attrs:{src:i("359c")}})])])])])},m=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("span",[t._v("An experiment made by "),i("a",{staticClass:"link",attrs:{href:"https://www.cesarbotana.com"}},[t._v("César Botana")])])])}],v={name:"Home",methods:{gotoPage:function(t){this.$router.push("/".concat(t))}}},y=v,b=(i("5cf8"),Object(h["a"])(y,p,m,!1,null,"f763c07e",null)),g=b.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"editor"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"validating"!==t.state,expression:"state !== 'validating'"}],staticClass:"toolbar"},[i("div",{staticClass:"controlsSection"},[i("div",{staticClass:"toolbarButton",class:{disabled:"idle"!==t.state||0===t.actionsQueue.idx},attrs:{title:"Undo (Ctrl + Z)"},on:{click:t.undoAction}},[i("i",{staticClass:"fas fa-arrow-left"})]),i("div",{staticClass:"toolbarButton",class:{disabled:"idle"!==t.state||t.actionsQueue.idx>=t.actionsQueue.queue.length},attrs:{title:"Redo (Ctrl + Y)"},on:{click:t.redoAction}},[i("i",{staticClass:"fas fa-arrow-right"})])]),i("div",{staticClass:"controlsSection"},[i("div",{staticClass:"toolbarButton",class:{active:"select"===t.activeTransform,disabled:"idle"!==t.state},attrs:{title:"Select (Q)"},on:{click:function(e){return t.selectTransform("select")}}},[i("i",{staticClass:"fas fa-mouse-pointer"})]),i("div",{staticClass:"toolbarButton",class:{active:"translate"===t.activeTransform,disabled:"idle"!==t.state},attrs:{title:"Select and Move (W)"},on:{click:function(e){return t.selectTransform("translate")}}},[i("i",{staticClass:"fas fa-arrows-alt"})]),i("div",{staticClass:"toolbarButton",class:{active:"rotate"===t.activeTransform,disabled:"idle"!==t.state},attrs:{title:"Select and Rotate (E)"},on:{click:function(e){return t.selectTransform("rotate")}}},[i("i",{staticClass:"fas fa-undo"})]),i("div",{staticClass:"toolbarButton",class:{disabled:"idle"!==t.state||0===t.selectedEntities.length},attrs:{title:"Delete Selected (Supr)"},on:{click:t.removeSelectedEntities}},[i("i",{staticClass:"far fa-trash-alt"})])]),i("div",{staticClass:"controlsSection"},[i("div",{staticClass:"toolbarButton",class:{invisible:"playingFromSelection"===t.state||"paused"===t.state&&"playingFromSelection"===t.stateBeforePause,hidden:"playing"===t.state||"paused"===t.state&&"playingFromSelection"!==t.stateBeforePause},attrs:{title:"Play (Space)"},on:{click:function(e){return t.play(!1)}}},[i("i",{staticClass:"fas fa-play"})]),"idle"!==t.state?i("div",{staticClass:"toolbarButton",attrs:{title:"Stop (Space)"},on:{click:t.stop}},[i("i",{staticClass:"fas fa-stop"})]):t._e(),"idle"===t.state&&1===t.selectedEntities.length&&"tile"===t.selectedEntities[0].type?i("div",{staticClass:"toolbarButton",attrs:{title:"Play from Selection (Ctrl + Space)"},on:{click:function(e){return t.play(!0)}}},[i("i",{staticClass:"far fa-play-circle"})]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"idle"!==t.state,expression:"state !== 'idle'"}],staticClass:"toolbarButton",class:{active:"paused"===t.state},attrs:{title:"Pause"},on:{click:t.togglePause}},[i("i",{staticClass:"fas fa-pause"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:"paused"===t.state,expression:"state === 'paused'"}],staticClass:"toolbarButton",attrs:{title:"Step Forward"},on:{click:t.stepForward}},[i("i",{staticClass:"fas fa-step-forward"})])]),i("div",{staticClass:"entitiesStats"},[t._v(t._s(t.numValidEntitiesInTheScene)+" of "+t._s(t.maxNumEntitiesInScene)+" elements used")]),i("div",{staticClass:"controlsSection",style:{"margin-left":"auto","margin-right":"40px"}},[t.sceneUuid?i("div",{staticClass:"sceneUuid"},[i("div",{staticClass:"toolbarButton",attrs:{title:"Copy board URL to the clipboard"},on:{click:t.copySceneUrlToClipboard}},[i("i",{staticClass:"fas fa-share-square"})])]):i("div",{staticClass:"toolbarButton",class:{disabled:"idle"!==t.state||t.numValidEntitiesInTheScene>t.maxNumEntitiesInScene},attrs:{title:"Publish Board"},on:{click:t.publishScene}},[i("i",{staticClass:"fas fa-cloud-upload-alt"})]),i("div",{staticClass:"toolbarButton",class:{disabled:"idle"!==t.state},attrs:{title:"Help"},on:{click:t.openHelpDialog}},[i("i",{staticClass:"fas fa-question"})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:"validating"===t.state,expression:"state === 'validating'"}],staticClass:"validatingScene"},[i("div",{staticClass:"mask"},[i("div",{staticClass:"messageArea"},[i("div",{staticClass:"message"},[t._v("Validating board...")]),i("div",{staticClass:"toolbarButton",on:{click:t.cancelValidation}},[t._v("Cancel")])])])]),i("div",{ref:"scene",staticClass:"scene",class:{batchStamperActive:t.batchStamper.active},on:{mousedown:t.onMouseDown,mouseup:t.onMouseUp,mousemove:t.onMouseMove}},[t.batchStamper.active?i("div",{staticClass:"stamperMessage"},[t._v("Stamper Mode")]):t._e()]),i("div",{staticClass:"panel"},[i("CommandPanel",{ref:"commandPanel",attrs:{batchStamperParameters:t.batchStamper.parameters,selectedEntities:t.selectedEntities,editingGroup:t.world?t.world.group:null},on:{"batch-stamper-on":t.onBatchStamperOn,"batch-stamper-off":t.onBatchStamperOff,"rebuild-batch-stamper":t.rebuildBatchStamper,"rotate-selected-entities":t.rotateSelectedEntities,"move-selected-entities":t.moveSelectedEntities,"colorize-selected-entities":t.colorizeSelectedEntities,"rotate-group-entities":t.rotateGroupEntities,"move-group-entities":t.moveGroupEntities,"colorize-group-entities":t.colorizeGroupEntities,"select-entities":t.onSelectEntities,"deselect-entities":t.onDeselectEntities}})],1),i("IODialog",{directives:[{name:"show",rawName:"v-show",value:"ioDialog"===t.dialogVisible,expression:"dialogVisible === 'ioDialog'"}],ref:"ioDialog",on:{close:function(e){t.dialogVisible=null}}}),i("PublishDialog",{directives:[{name:"show",rawName:"v-show",value:"publishDialog"===t.dialogVisible,expression:"dialogVisible === 'publishDialog'"}],ref:"publishDialog",on:{close:t.closePublishDialog}}),i("HelpDialog",{directives:[{name:"show",rawName:"v-show",value:"helpDialog"===t.dialogVisible,expression:"dialogVisible === 'helpDialog'"}],ref:"helpDialog",on:{close:function(e){t.dialogVisible=null}}}),t.selectionBox?i("div",{ref:"selectionBox",staticClass:"selectionBox",style:{top:t.selectionBox.top+"px",left:t.selectionBox.left+"px",width:t.selectionBox.width+"px",height:t.selectionBox.height+"px"}}):t._e()],1)},x=[],C=(i("99af"),i("4de4"),i("7db0"),i("c975"),i("d81d"),i("fb6a"),i("a434"),i("b0c0"),i("4c53"),i("b85c")),P=i("2ef0"),S=i.n(P),k=i("5a89"),E=i("24bc"),T=i.n(E),O=i("4721"),B=i("b1f1"),z=5e3,j=1,D=2,I={x:2,y:4,z:.6},_={x:100,y:1,z:100},M=2.5,A=(I.y+_.y)/2+.05,F=M+.5,R=100,$=new k["b"](_.x,_.y,_.z),V=new k["b"](I.x,I.y,I.z),L=new k["D"](M,24,24),W=50,G=30,N=i("262e"),U=i("2caf"),Y=i("d4ec"),q=i("bee2"),Z=function(){function t(e,i){Object(Y["a"])(this,t),this.options=e||{},this.editor=i}return Object(q["a"])(t,[{key:"redo",value:function(){this.do()}},{key:"do",value:function(){}},{key:"undo",value:function(){}}]),t}(),H=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;return Object(Y["a"])(this,i),a=e.call(this,t,s),a.entities=S.a.clone(a.options.entities),a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=Object(C["a"])(this.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.addToRenderWorld(),this.options.group.addChild(i)}}catch(s){e.e(s)}finally{e.f()}}},{key:"undo",value:function(){var t,e=Object(C["a"])(this.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.removeFromRenderWorld(),this.options.group.removeChild(i)}}catch(s){e.e(s)}finally{e.f()}}}]),i}(Z),Q=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;Object(Y["a"])(this,i),a=e.call(this,t,s),a.previousPosition={};var n,o=Object(C["a"])(t.entities);try{for(o.s();!(n=o.n()).done;){var r=n.value;a.previousPosition[r.id]=r.position.clone()}}catch(l){o.e(l)}finally{o.f()}return a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=Object(C["a"])(this.options.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.setPosition(i.position.x+this.options.offset.x,i.position.y+this.options.offset.y,i.position.z+this.options.offset.z)}}catch(s){e.e(s)}finally{e.f()}}},{key:"undo",value:function(){var t,e=Object(C["a"])(this.options.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value,s=this.previousPosition[i.id];i.setPosition(s.x,s.y,s.z)}}catch(a){e.e(a)}finally{e.f()}}}]),i}(Z),X=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;Object(Y["a"])(this,i),a=e.call(this,t,s),a.previousRotation={};var n,o=Object(C["a"])(t.entities);try{for(o.s();!(n=o.n()).done;){var r=n.value;a.previousRotation[r.id]=r.angleY}}catch(l){o.e(l)}finally{o.f()}return a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=Object(C["a"])(this.options.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.setRotation(i.angleY+this.options.offset)}}catch(s){e.e(s)}finally{e.f()}}},{key:"undo",value:function(){var t,e=Object(C["a"])(this.options.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.setRotation(this.previousRotation[i.id])}}catch(s){e.e(s)}finally{e.f()}}}]),i}(Z),K=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;return Object(Y["a"])(this,i),a=e.call(this,t,s),a.entities=S.a.clone(a.options.entities),a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=[],i=Object(C["a"])(this.entities);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.removeFromRenderWorld(),this.options.group.removeChild(s),e.push(s)}}catch(a){i.e(a)}finally{i.f()}this.editor.deselectEntities(e)}},{key:"undo",value:function(){var t,e=[],i=Object(C["a"])(this.entities);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.addToRenderWorld(),this.options.group.addChild(s),e.push(s)}}catch(a){i.e(a)}finally{i.f()}this.editor.selectEntities(e,!0)}}]),i}(Z),J=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;return Object(Y["a"])(this,i),a=e.call(this,t,s),a.entities=S.a.clone(a.options.entities),a.prevSelection=S.a.clone(a.editor.selectedEntities),a}return Object(q["a"])(i,[{key:"do",value:function(){this.editor.selectEntities(this.entities,this.options.adding)}},{key:"undo",value:function(){this.editor.selectEntities(this.prevSelection)}}]),i}(Z),tt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;return Object(Y["a"])(this,i),a=e.call(this,t,s),a.entities=S.a.clone(a.options.entities),a}return Object(q["a"])(i,[{key:"do",value:function(){this.editor.deselectEntities(this.entities)}},{key:"undo",value:function(){this.editor.selectEntities(this.entities,!0)}}]),i}(Z),et=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;Object(Y["a"])(this,i),a=e.call(this,t,s);var n,o=Object(C["a"])(a.options.actions);try{for(o.s();!(n=o.n()).done;){var r=n.value;r.editor=s}}catch(l){o.e(l)}finally{o.f()}return a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=Object(C["a"])(this.options.actions);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.do()}}catch(s){e.e(s)}finally{e.f()}}},{key:"undo",value:function(){var t,e=Object(C["a"])(this.options.actions);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.undo()}}catch(s){e.e(s)}finally{e.f()}}}]),i}(Z),it=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s){var a;return Object(Y["a"])(this,i),a=e.call(this,t,s),a.entities=S.a.clone(a.options.entities),a.prevColors={},a}return Object(q["a"])(i,[{key:"do",value:function(){var t,e=Object(C["a"])(this.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;"group"!==i.type&&(this.prevColors[i.id]=i.getColor(),i.setColor(this.options.color))}}catch(s){e.e(s)}finally{e.f()}}},{key:"undo",value:function(){var t,e=Object(C["a"])(this.entities);try{for(e.s();!(t=e.n()).done;){var i=t.value;"group"!==i.type&&i.setColor(this.prevColors[i.id])}}catch(s){e.e(s)}finally{e.f()}}}]),i}(Z),st=(i("cb29"),i("d3b7"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),function(){function t(e,i,s){Object(Y["a"])(this,t),this.auxMatrix=new k["r"],this.auxColor=new k["d"],this.auxVector=new k["I"],this.auxVector2=new k["I"],this.auxQuaternion=new k["A"],this.auxEuler=new k["h"](0,0,0,"XYZ"),this.size=e,this.needsTransformUpdate=!1,this.needsColorUpdate=!1;var a=new k["l"];this.colors=new Float32Array(3*e),this.colors.fill(16777215,0,e),a.vertexColors=!0,a.setAttribute("color",new k["k"](this.colors,3)),this.material=new k["u"]({vertexColors:!0}),k["c"].prototype.copy.call(a,i),this.mesh=new k["m"](a,this.material,e),this.mesh.castShadow=s,this.mesh.receiveShadow=!0,this.mesh.iMesh=this}return Object(q["a"])(t,[{key:"setCount",value:function(t){this.mesh.count=t}},{key:"getCount",value:function(){return this.mesh.count}},{key:"setTransformAt",value:function(t,e,i,s,a,n){S.a.isUndefined(n)&&(n=1),this.auxMatrix.identity(),this.auxQuaternion.setFromEuler(new k["h"](0,a,0)),this.auxVector.set(e,i,s),this.auxVector2.set(n,n,n),this.auxMatrix.compose(this.auxVector,this.auxQuaternion,this.auxVector2),this.mesh.setMatrixAt(t,this.auxMatrix),this.needsTransformUpdate=!0}},{key:"setColorAt",value:function(t,e){this.colors&&(this.auxColor.set(e),this.auxColor.toArray(this.colors,3*t),this.needsColorUpdate=!0)}},{key:"getColorAt",value:function(t){return this.colors?(this.auxColor.fromArray(this.colors,3*t),"#".concat(this.auxColor.getHexString())):"#ffffff"}},{key:"prepareRender",value:function(){this.needsColorUpdate&&this.colors&&this.mesh.geometry.setAttribute("color",new k["k"](this.colors,3)),this.mesh.instanceMatrix.needsUpdate=this.needsTransformUpdate,this.needsColorUpdate=!1,this.needsTransformUpdate=!1}}]),t}()),at=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t,s,a){var n;Object(Y["a"])(this,i),n=e.call(this,t,s,a),n.freeEntries=[];for(var o=0;o<n.size;++o)n.freeEntries.push(o);return n}return Object(q["a"])(i,[{key:"useEntry",value:function(){return 0===this.freeEntries.length?-1:this.freeEntries.pop()}},{key:"freeEntry",value:function(t){this.freeEntries.push(t)}}]),i}(st),nt=0,ot=new T.a.btBoxShape(new T.a.btVector3(55,.5,55)),rt=new T.a.btVector3(0,0,0);ot.calculateLocalInertia(0,rt);var lt=5,ct=new T.a.btBoxShape(new T.a.btVector3(I.x/2,I.y/2,I.z/2)),ht=new T.a.btVector3(0,0,0);ct.calculateLocalInertia(lt,ht);var dt=5,ut=new T.a.btSphereShape(M),ft=new T.a.btVector3(0,0,0);ut.calculateLocalInertia(dt,ft);var pt=1,mt=new k["d"](16737792),vt=0,yt=function(){function t(e){Object(Y["a"])(this,t),this.options=e||{},this.id=vt++,this.name=this.options.name||"Entity",this.position=this.options.position?this.options.position.clone():new k["I"],this.rotation=new k["A"],this.angleY=0,this.parent=this.options.parent||null,this.userData=this.options.userData||{},this.type=this.options.type||"entity",this.visible=!0,this.frozen=!1,e.angleY?(this.angleY=e.angleY,this.rotation.setFromEuler(new k["h"](0,e.angleY,0))):e.rotation&&this.rotation.copy(e.rotation)}return Object(q["a"])(t,[{key:"setPosition",value:function(t,e,i){this.position.set(t,e,i)}},{key:"getWorldPosition",value:function(){if(!this.parent)return this.position.clone();var t=this.position.clone();return t.add(this.parent.getWorldPosition()),t}},{key:"setRotation",value:function(t){this.angleY=t,this.rotation.setFromEuler(new k["h"](0,t,0))}},{key:"getRotationY",value:function(){return this.angleY}},{key:"getWorldRotationY",value:function(){return this.parent?this.parent.getWorldRotationY()+this.angleY:this.angleY}},{key:"move",value:function(t,e,i){this.position.set(this.position.x+t,this.position.y+e,this.position.z+i)}},{key:"rotate",value:function(t){this.setRotation(this.angleY+t)}},{key:"setParent",value:function(t){this.parent=t}},{key:"getColor",value:function(){return"#ffffff"}},{key:"setVisible",value:function(t){this.visible=t}},{key:"setFrozen",value:function(t){this.frozen=t}},{key:"tick",value:function(){}}]),t}(),bt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){var s;return Object(Y["a"])(this,i),s=e.call(this,S.a.assign(t,{type:"group"})),s.children=[],s}return Object(q["a"])(i,[{key:"addChild",value:function(t){t.setParent(this),this.children.push(t)}},{key:"removeChild",value:function(t){t.setParent(null),this.children=this.children.filter((function(e){return e.id!==t.id}))}},{key:"tick",value:function(t){var e,i=Object(C["a"])(this.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.tick(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"saveState",value:function(){var t,e=Object(C["a"])(this.children);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.saveState()}}catch(s){e.e(s)}finally{e.f()}}},{key:"restoreState",value:function(){var t,e=Object(C["a"])(this.children);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.restoreState()}}catch(s){e.e(s)}finally{e.f()}}},{key:"setVisible",value:function(t){yt.prototype.setVisible.call(this,t);var e,i=Object(C["a"])(this.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;"group"===s.type?s.setVisible(t):(t?s.visible&&s.scale.set(1,1,1):s.scale.set(0,0,0),s.updateMatrix())}}catch(a){i.e(a)}finally{i.f()}}},{key:"addToRenderWorld",value:function(){var t,e=Object(C["a"])(this.children);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.addToRenderWorld()}}catch(s){e.e(s)}finally{e.f()}}},{key:"removeFromRenderWorld",value:function(){var t,e=Object(C["a"])(this.children);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.removeFromRenderWorld()}}catch(s){e.e(s)}finally{e.f()}}},{key:"addToPhysicalWorld",value:function(t){var e,i=Object(C["a"])(this.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.addToPhysicalWorld(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"removeFromPhysicalWorld",value:function(t){var e,i=Object(C["a"])(this.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;s.removeFromPhysicalWorld(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"findChildById",value:function(t){var e,i=Object(C["a"])(this.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;if("group"===s.type){if(s.id===t)return s;var a=s.findChildById(t);if(null!==a)return a}else if(s.id===t)return s}}catch(n){i.e(n)}finally{i.f()}return null}},{key:"findChildByIMeshEntry",value:function(t,e){var i,s=Object(C["a"])(this.children);try{for(s.s();!(i=s.n()).done;){var a=i.value;if("group"===a.type){var n=a.findChildByIMeshEntry(t,e);if(null!==n)return n}else if(a.iMeshEntry===e&&a.iMesh.name===t)return a}}catch(o){s.e(o)}finally{s.f()}return null}},{key:"setPosition",value:function(t,e,i){var s=this.position.clone();yt.prototype.setPosition.call(this,t,e,i);var a,n=Object(C["a"])(this.children);try{for(n.s();!(a=n.n()).done;){var o=a.value;"group"!==o.type&&(o.frozen?o.move(s.x-t,s.y-e,s.z-i):o.updateMatrix())}}catch(r){n.e(r)}finally{n.f()}}},{key:"setRotation",value:function(t){this.rotate(t-this.angleY)}},{key:"move",value:function(t,e,i){yt.prototype.move.call(this,t,e,i);var s,a=Object(C["a"])(this.children);try{for(a.s();!(s=a.n()).done;){var n=s.value;"group"!==n.type&&(n.frozen?n.move(-t,-e,-i):n.updateMatrix())}}catch(o){a.e(o)}finally{a.f()}}},{key:"rotate",value:function(t){yt.prototype.setRotation.call(this,this.angleY+t);var e,i=Math.cos(t),s=Math.sin(t),a=Object(C["a"])(this.children);try{for(a.s();!(e=a.n()).done;){var n=e.value;if("group"!==n.type&&!n.frozen){var o=i*n.position.x-s*n.position.z,r=s*n.position.x+i*n.position.z;n.setPosition(o,n.position.y,r),n.rotate(-t),n.updateMatrix()}}}catch(l){a.e(l)}finally{a.f()}}}]),i}(yt),gt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){var s;return Object(Y["a"])(this,i),s=e.call(this,t),s.iMesh=s.options.iMesh,s.matrix=new k["r"],s.scale=0,s.iMeshEntry=-1,s.fallingTimer=0,s.world=null,s.state="idle",s.color=s.options.color||"#ffffff",s.overrideColor=null,s}return Object(q["a"])(i,[{key:"setPosition",value:function(t,e,i){yt.prototype.setPosition.call(this,t,e,i),this.updateMatrix()}},{key:"setRotation",value:function(t){yt.prototype.setRotation.call(this,t),this.updateMatrix()}},{key:"move",value:function(t,e,i){yt.prototype.move.call(this,t,e,i),this.updateMatrix()}},{key:"rotate",value:function(t){yt.prototype.rotate.call(this,t),this.updateMatrix()}},{key:"saveState",value:function(){this.positionSaved=this.position.clone(),this.rotationSaved=this.rotation.clone(),this.stateSaved=this.state}},{key:"restoreState",value:function(){this.position.copy(this.positionSaved),this.rotation.copy(this.rotationSaved),this.state=this.stateSaved,this.updateMatrix()}},{key:"updateMatrix",value:function(){var t=this.getWorldPosition();this.iMesh.setTransformAt(this.iMeshEntry,t.x,t.y,t.z,this.angleY,this.scale)}},{key:"addToRenderWorld",value:function(){-1===this.iMeshEntry&&(this.iMeshEntry=this.iMesh.useEntry(),-1!==this.iMeshEntry&&(this.setVisible(!0),this.setColor(this.color)))}},{key:"removeFromRenderWorld",value:function(){-1!==this.iMeshEntry&&-1!==this.iMeshEntry&&(this.setVisible(!1),this.iMesh.freeEntry(this.iMeshEntry),this.iMeshEntry=-1)}},{key:"addToPhysicalWorld",value:function(t){if(!this.body){var e=new T.a.btTransform,i=this.getWorldPosition();e.setIdentity(),e.setOrigin(new T.a.btVector3(i.x,i.y,i.z)),e.setRotation(new T.a.btQuaternion(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.w));var s=new T.a.btDefaultMotionState(e),a=new T.a.btRigidBodyConstructionInfo(this.options.mass,s,this.options.shape,this.options.localInertia);this.body=new T.a.btRigidBody(a),this.world=t,t.physicsWorld.addRigidBody(this.body)}}},{key:"removeFromPhysicalWorld",value:function(t){this.body&&(t.physicsWorld.removeRigidBody(this.body),this.body=null,this.world=null)}},{key:"setVisible",value:function(t){yt.prototype.setVisible.call(this,t),t&&this.parent&&!this.parent.visible||(this.scale=t?1:0,this.updateMatrix())}},{key:"setColor",value:function(t){-1!==this.iMeshEntry&&(this.color=t,this.iMesh.setColorAt(this.iMeshEntry,t))}},{key:"getColor",value:function(){return this.color}},{key:"setFadingIntensity",value:function(t){if(-1!==this.iMeshEntry){var e=new k["d"](this.color).lerp(mt,t).getHexString();this.iMesh.setColorAt(this.iMeshEntry,"#".concat(e))}}},{key:"setParent",value:function(t){yt.prototype.setParent.call(this,t),this.updateMatrix()}}]),i}(yt),wt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){return Object(Y["a"])(this,i),e.call(this,S.a.assign(t,{type:"ground",mass:nt,shape:ot,localInertia:rt}))}return i}(gt),xt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){var s;return Object(Y["a"])(this,i),s=e.call(this,t),s.tmpTrans=new T.a.btTransform,s}return Object(q["a"])(i,[{key:"tick",value:function(){if(!this.body||"slept"===this.state)return!1;var t=this.body.getMotionState();t.getWorldTransform(this.tmpTrans);var e=this.tmpTrans.getOrigin(),i=this.tmpTrans.getRotation(),s=this.iMesh.mesh.instanceMatrix.array,a=16*this.iMeshEntry,n=i.x(),o=i.y(),r=i.z(),l=i.w(),c=n+n,h=o+o,d=r+r,u=n*c,f=n*h,p=n*d,m=o*h,v=o*d,y=r*d,b=l*c,g=l*h,w=l*d;return s[a+0]=1-(m+y),s[a+1]=f+w,s[a+2]=p-g,s[a+3]=0,s[a+4]=f-w,s[a+5]=1-(u+y),s[a+6]=v+b,s[a+7]=0,s[a+8]=p+g,s[a+9]=v-b,s[a+10]=1-(u+m),s[a+11]=0,s[a+12]=e.x(),s[a+13]=e.y(),s[a+14]=e.z(),s[a+15]=1,this.iMesh.mesh.instanceMatrix.needsUpdate=!0,!0}}]),i}(gt),Ct=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){var s;return Object(Y["a"])(this,i),s=e.call(this,S.a.assign(t,{type:"ball",mass:dt,shape:ut,localInertia:ft})),s.tmpTrans=new T.a.btTransform,s}return i}(xt),Pt=function(t){Object(N["a"])(i,t);var e=Object(U["a"])(i);function i(t){return Object(Y["a"])(this,i),e.call(this,S.a.assign(t,{type:"tile",mass:lt,shape:ct,localInertia:ht}))}return Object(q["a"])(i,[{key:"tick",value:function(t){if(xt.prototype.tick.call(this,t)){var e=this.tmpTrans.getRotation(),i=new k["A"](e.x(),e.y(),e.z(),e.w()),s=new k["A"];s.setFromEuler(new k["h"](0,this.angleY,0));var a=i.angleTo(s);"idle"===this.state&&a>.5?(this.state="falling",this.fallingTimer=pt):"falling"===this.state&&(this.fallingTimer-=t,this.fallingTimer<=0&&(this.state="slept",this.removeFromPhysicalWorld(this.world)))}}}]),i}(xt),St=function(){function t(e){Object(Y["a"])(this,t),this.domElement=e.domElement,this.auxColor=new k["d"],this.renderer=new k["J"]({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.domElement.clientWidth,this.domElement.clientHeight),this.renderer.setClearColor("#353535"),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=k["x"],this.domElement.appendChild(this.renderer.domElement);var i=e.cameraPosition;this.camera=new k["y"](45,this.domElement.clientWidth/this.domElement.clientHeight,.5,500),this.camera.position.set(i.x,i.y,i.z),this.scene=new k["C"],this.group=new bt;var s=new k["a"](13421772);this.scene.add(s);var a=new k["f"](16777215,.7);this.lightTarget=new k["v"],this.lightTarget.position.set(this.camera.position.x+90,0,this.camera.position.z),this.scene.add(this.lightTarget),a.position.set(i.x+110,i.y+70,i.z-20),a.target=this.lightTarget,a.castShadow=!0,a.shadow.camera.near=.5,a.shadow.camera.far=500,a.shadow.bias=1e-4,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048;var n=150;a.shadow.camera.left=-n,a.shadow.camera.right=n,a.shadow.camera.top=n,a.shadow.camera.bottom=-n,this.directionalLight=a,this.scene.add(a),this.imTiles=new at(e.numTiles,V,!0),this.imTiles.name="tiles",this.scene.add(this.imTiles.mesh),this.imGrounds=new at(e.numGrounds,$,!1),this.imGrounds.name="grounds",this.scene.add(this.imGrounds.mesh),this.imBalls=new at(e.numBalls,L,!0),this.imBalls.name="balls",this.scene.add(this.imBalls.mesh);var o=new T.a.btDefaultCollisionConfiguration,r=new T.a.btCollisionDispatcher(o),l=new T.a.btDbvtBroadphase,c=new T.a.btSequentialImpulseConstraintSolver;this.physicsWorld=new T.a.btDiscreteDynamicsWorld(r,l,c,o),this.physicsWorld.setGravity(new T.a.btVector3(0,-400,0))}return Object(q["a"])(t,[{key:"tick",value:function(t){this.physicsWorld.stepSimulation(1/60,8),this.group.tick(t)}},{key:"render",value:function(){this.imTiles.prepareRender(),this.imGrounds.prepareRender(),this.imBalls.prepareRender(),this.renderer.render(this.scene,this.camera)}},{key:"onWindowResize",value:function(){this.camera.aspect=this.domElement.clientWidth/this.domElement.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.domElement.clientWidth,this.domElement.clientHeight)}}]),t}(),kt=(i("ddb0"),i("3835")),Et=function(){function t(){Object(Y["a"])(this,t),this.active=!1,this.type=null,this.stamperInitialPos=null,this.stamperFinalPos=null,this.stamperPos=null,this.batchDef={},this.freeModePoints=[],this.parameters={single:{rotation:0,color:"#02ACA5"},line:{forwardOffset:2,fixedRotation:!1,rotation:0,color:"#02ACA5"},free:{forwardOffset:2,fixedRotation:!1,rotation:0,color:"#02ACA5"},triangle:{forwardOffset:2,rightOffset:2.5,fixedRotation:!1,rotation:0,color:"#02ACA5"},rectangle:{forwardOffset:3,rightOffset:3,rotation:0,color:"#02ACA5"},image:{filename:"None",width:0,height:0,rawData:null,data:null,forwardOffset:3,rightOffset:2,rotation:0,horSize:25,verSize:25},ball:{color:"#EA7251"}}}return Object(q["a"])(t,[{key:"init",value:function(t){this.editor=t,this.imTiles=new st(z,V,!0),this.imBalls=new st(1,L,!0),t.world.scene.add(this.imTiles.mesh),t.world.scene.add(this.imBalls.mesh)}},{key:"render",value:function(){this.imTiles.prepareRender(),this.imBalls.prepareRender()}},{key:"reset",value:function(){this.stamperInitialPos=null,this.stamperFinalPos=null,this.stamperPos=null,this.freeModePoints=[],this.imTiles.setCount(0),this.imBalls.setCount(0)}},{key:"setType",value:function(t){this.type=t}},{key:"show",value:function(t){t||(this.imTiles.setCount(0),this.imBalls.setCount(0))}},{key:"onMouseUp",value:function(t){var e=this.editor.getGroundHitPoint(t.offsetX,t.offsetY);if(e){if("single"===this.type||"image"===this.type||"ball"===this.type)return{x:e.x,z:e.z};if(this.stamperInitialPos)return{x:this.stamperInitialPos.x,z:this.stamperInitialPos.z};this.stamperInitialPos=e.clone(),"free"===this.type&&this.freeModePoints.push({x:e.x,z:e.z})}return null}},{key:"onMouseMove",value:function(t){if(this.active){var e=this.editor.getGroundHitPoint(t.offsetX,t.offsetY);if(e){if("free"===this.type)if(this.freeModePoints.length>0){var i=this.freeModePoints[this.freeModePoints.length-1],s=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.z-i.z,2));s>=this.parameters[this.type].forwardOffset&&(this.freeModePoints.push({x:e.x,z:e.z}),this.rebuild())}else this.stamperPos=e.clone();else"single"===this.type||"ball"===this.type?this.stamperPos=e.clone():this.stamperInitialPos?this.stamperFinalPos=e.clone():this.stamperPos=e.clone();this.rebuild()}else this.stamperInitialPos||"free"===this.type&&0!==this.freeModePoints.length||this.show(!1)}}},{key:"createEntitiesFromStamper",value:function(t,e){for(var i=[],s=0;s<this.batchDef.entities.length;++s){var a=this.batchDef.entities[s],n=new k["I"](a.offset.x,"ball"===a.entityType?F:A,a.offset.z);this.stamperInitialPos?(n.x-=this.stamperInitialPos.x,n.z-=this.stamperInitialPos.z):"image"===this.type&&(n.x-=this.stamperPos.x,n.z-=this.stamperPos.z);var o=void 0;o="ball"===a.entityType?new Ct({name:"Ball",position:n,iMesh:t.imBalls,color:a.color||this.parameters[this.type].color}):new Pt({name:"Tile",position:n,angleY:a.rotation,iMesh:t.imTiles,color:a.color||this.parameters[this.type].color}),i.push(o),e&&e.addChild(o)}return i}},{key:"getParameters",value:function(){return this.parameters[this.type]}},{key:"rebuild",value:function(){if(this.active){this.batchDef={rotation:0,entities:[]};var t=this.parameters[this.type];switch(this.type){case"single":this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z},rotation:k["q"].degToRad(parseFloat(t.rotation))});break;case"ball":this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z},entityType:"ball"});break;case"line":if(this.stamperInitialPos){var e=this.stamperFinalPos.clone();e.sub(this.stamperInitialPos);var i=e.length();e.normalize();var s=parseFloat(t.forwardOffset),a=k["q"].degToRad(parseFloat(t.rotation)),n=0,o=0;while(n<i){var r=o*s,l={x:this.stamperInitialPos.x+e.x*r,z:this.stamperInitialPos.z+e.z*r},c=t.fixedRotation?a:Math.atan2(e.x,e.z);this.batchDef.entities.push({offset:l,rotation:c}),n+=s,++o}}else this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z}});break;case"triangle":if(this.stamperInitialPos){var h=this.stamperFinalPos.clone();h.sub(this.stamperInitialPos);var d=h.length();h.normalize();var u=parseFloat(t.forwardOffset),f=parseFloat(t.rightOffset),p=k["q"].degToRad(parseFloat(t.rotation)),m={x:-h.z,z:h.x},v=0,y=0;while(v<d){for(var b=y*u,g=f*y/2,w=0;w<y+1;++w){var x={x:this.stamperInitialPos.x+h.x*b+m.x*g,z:this.stamperInitialPos.z+h.z*b+m.z*g},P=t.fixedRotation?p:Math.atan2(h.x,h.z);this.batchDef.entities.push({offset:x,rotation:P}),g-=f}v+=u,++y}}else this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z}});break;case"rectangle":if(this.stamperInitialPos){var S=this.stamperFinalPos.clone();S.sub(this.stamperInitialPos);var E=S.x<0?-1:1,T=S.z<0?-1:1;S.x=Math.abs(S.x),S.z=Math.abs(S.z);var O=parseFloat(t.forwardOffset),B=parseFloat(t.rightOffset),j=k["q"].degToRad(parseFloat(t.rotation)),D={x:0,z:0},I=0;while(I<S.x){var _=0;while(_<S.z)this.batchDef.entities.push({offset:{x:this.stamperInitialPos.x+D.x,z:this.stamperInitialPos.z+D.z},rotation:j}),D.z+=B*T,_+=B;D.x+=O*E,D.z=0,I+=O}}else this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z}});break;case"image":if(t.data&&this.stamperPos)for(var M=parseFloat(t.forwardOffset),R=parseFloat(t.rightOffset),$=k["q"].degToRad(parseFloat(t.rotation)),V={x:0,z:0},L=Math.floor(t.width/t.horSize),W=Math.floor(t.height/t.verSize),G=0;G<t.verSize;++G){for(var N=G*W*t.width,U=0;U<t.horSize;++U){var Y=t.data[N];this.batchDef.entities.push({offset:{x:this.stamperPos.x+V.x,z:this.stamperPos.z+V.z},rotation:$,color:Y}),V.z+=R,N+=L}V.z=0,V.x-=M}break;case"free":var q=k["q"].degToRad(parseFloat(t.rotation));if(this.freeModePoints.length>0){var Z,H=Object(C["a"])(this.freeModePoints.entries());try{for(H.s();!(Z=H.n()).done;){var Q=Object(kt["a"])(Z.value,2),X=Q[0],K=Q[1],J={x:0,z:0};t.fixedRotation||(0===X?this.freeModePoints.length>1&&(J.x=this.freeModePoints[1].x-this.freeModePoints[0].x,J.z=this.freeModePoints[1].z-this.freeModePoints[0].z):(J.x=this.freeModePoints[X].x-this.freeModePoints[X-1].x,J.z=this.freeModePoints[X].z-this.freeModePoints[X-1].z));var tt=t.fixedRotation?q:Math.atan2(J.x,J.z);this.batchDef.entities.push({offset:{x:K.x,z:K.z},rotation:tt})}}catch(at){H.e(at)}finally{H.f()}}else this.stamperPos&&this.batchDef.entities.push({offset:{x:this.stamperPos.x,z:this.stamperPos.z},rotation:t.fixedRotation?q:0});break}var et="ball"===this.type?this.imBalls:this.imTiles;et.setCount(Math.min(this.batchDef.entities.length,z));for(var it=0;it<this.batchDef.entities.length;++it){var st=this.batchDef.entities[it];et.setColorAt(it,st.color||t.color),et.setTransformAt(it,st.offset.x,"ball"===st.entityType?F:A,st.offset.z,st.rotation||0)}}}}]),t}(),Tt=[{keyCode:"KeyZ",ctrlPressed:!0,shiftPressed:!1,method:"undoAction"},{keyCode:"KeyZ",ctrlPressed:!0,shiftPressed:!0,method:"redoAction"},{keyCode:"KeyY",ctrlPressed:!0,shiftPressed:!1,method:"redoAction"},{keyCode:"KeyQ",ctrlPressed:!1,shiftPressed:!1,method:function(t){t.selectTransform("select")}},{keyCode:"KeyW",ctrlPressed:!1,shiftPressed:!1,method:function(t){t.selectTransform("translate")}},{keyCode:"KeyE",ctrlPressed:!1,shiftPressed:!1,method:function(t){t.selectTransform("rotate")}},{keyCode:"Delete",ctrlPressed:!1,shiftPressed:!1,method:"removeSelectedEntities"},{keyCode:"Space",ctrlPressed:!1,shiftPressed:!1,method:function(t){"idle"===t.state?t.play():"playing"!==t.state&&"playingFromSelection"!==t.state&&"paused"!==t.state||t.stop()}},{keyCode:"Space",ctrlPressed:!0,shiftPressed:!1,method:function(t){"idle"===t.state?1===t.selectEntities.length&&"tile"===t.selectEntities[0].type&&t.play(!0):"playing"!==t.state&&"playingFromSelection"!==t.state&&"paused"!==t.state||t.stop()}}],Ot=function(){function t(e){Object(Y["a"])(this,t),this.editor=e,this.keysDown={},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}return Object(q["a"])(t,[{key:"onDestroyed",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"onKeyDown",value:function(t){if(!this.keysDown[t.key]&&null===this.editor.dialogVisible&&(!document.activeElement||"input"!==document.activeElement.tagName.toLowerCase())){var e,i=Object(C["a"])(Tt);try{for(i.s();!(e=i.n()).done;){var s=e.value;t.code===s.keyCode&&t.ctrlKey===s.ctrlPressed&&t.shiftKey===s.shiftPressed&&(S.a.isFunction(s.method)?s.method(this.editor):this.editor[s.method]())}}catch(a){i.e(a)}finally{i.f()}this.keysDown[t.key]=!0}}},{key:"onKeyUp",value:function(t){this.keysDown[t.key]=!1}},{key:"isKeyPressed",value:function(t){return this.keysDown[t]}}]),t}(),Bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"commandPanel"},[i("input",{ref:"fileSelector",staticClass:"fileSelector",attrs:{type:"file"},on:{change:t.loadFile}}),i("div",{staticClass:"panelContent"},[i("div",{staticClass:"container",class:{collapsed:t.containerCollapsed.sceneInspector},style:{"margin-bottom":"5px"}},[i("div",{staticClass:"header"},[i("div",{staticClass:"caret",on:{click:function(e){return t.toggleCollapseState("sceneInspector")}}},[t.containerCollapsed.sceneInspector?i("i",{staticClass:"fas fa-caret-right"}):i("i",{staticClass:"fas fa-caret-down"})]),i("div",{staticClass:"title"},[t._v("Board Inspector")])]),i("div",{staticClass:"content"},[i("SceneInspector",{ref:"sceneInspector",attrs:{editingGroup:t.editingGroup,selectedEntities:t.selectedEntities},on:{"select-entities":t.selectEntities,"deselect-entities":t.deselectEntities}})],1)]),i("div",{staticClass:"container",class:{collapsed:t.containerCollapsed.createBatch}},[i("div",{staticClass:"header"},[i("div",{staticClass:"caret",on:{click:function(e){return t.toggleCollapseState("createBatch")}}},[t.containerCollapsed.createBatch?i("i",{staticClass:"fas fa-caret-right"}):i("i",{staticClass:"fas fa-caret-down"})]),i("div",{staticClass:"title"},[t._v("Create Batch")])]),i("div",{staticClass:"content grid"},t._l(t.batchTypes,(function(e){return i("div",{key:e.id,staticClass:"toggleButton",class:{active:t.activeBatchType===e.id,disabled:e.disabled},on:{click:function(i){return t.selectBatchType(e.id)}}},[t._v(" "+t._s(e.name)+" ")])})),0)]),null!==t.activeBatchType?i("div",{staticClass:"container",class:{collapsed:t.containerCollapsed.stamperParameters}},[i("div",{staticClass:"header"},[i("div",{staticClass:"caret",on:{click:function(e){return t.toggleCollapseState("stamperParameters")}}},[t.containerCollapsed.stamperParameters?i("i",{staticClass:"fas fa-caret-right"}):i("i",{staticClass:"fas fa-caret-down"})]),i("div",{staticClass:"title"},[t._v("Batch Stamper Parameters")])]),i("div",{staticClass:"content"},t._l(t.activeBatchStamperParametersList,(function(e,s){return i("div",{key:"stamper_parameter_"+s,staticClass:"row"},[i("div",{staticClass:"label"},[t._v(t._s(e.label)+":")]),"image"===e.inputType?i("div",{staticClass:"value image",attrs:{title:t.activeBatchStamperParameters[e.field]},on:{click:function(i){return t.onBatchStamperParameterClick(e)}}},[t.activeBatchStamperParameters.rawData?i("img",{ref:"image",refInFor:!0,attrs:{src:t.activeBatchStamperParameters.rawData}}):t._e()]):"checkbox"===e.inputType?i("input",{directives:[{name:"model",rawName:"v-model",value:t.activeBatchStamperParameters[e.field],expression:"activeBatchStamperParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType,checkboxInput:"checkbox"===e.inputType,disabled:e.isEnabled&&!e.isEnabled()},attrs:{readonly:e.isEnabled&&!e.isEnabled(),type:"checkbox"},domProps:{checked:Array.isArray(t.activeBatchStamperParameters[e.field])?t._i(t.activeBatchStamperParameters[e.field],null)>-1:t.activeBatchStamperParameters[e.field]},on:{change:[function(i){var s=t.activeBatchStamperParameters[e.field],a=i.target,n=!!a.checked;if(Array.isArray(s)){var o=null,r=t._i(s,o);a.checked?r<0&&t.$set(t.activeBatchStamperParameters,e.field,s.concat([o])):r>-1&&t.$set(t.activeBatchStamperParameters,e.field,s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.activeBatchStamperParameters,e.field,n)},function(i){return t.updateBatchStamperParameter(e,i)}]}}):"radio"===e.inputType?i("input",{directives:[{name:"model",rawName:"v-model",value:t.activeBatchStamperParameters[e.field],expression:"activeBatchStamperParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType,checkboxInput:"checkbox"===e.inputType,disabled:e.isEnabled&&!e.isEnabled()},attrs:{readonly:e.isEnabled&&!e.isEnabled(),type:"radio"},domProps:{checked:t._q(t.activeBatchStamperParameters[e.field],null)},on:{change:[function(i){return t.$set(t.activeBatchStamperParameters,e.field,null)},function(i){return t.updateBatchStamperParameter(e,i)}]}}):i("input",{directives:[{name:"model",rawName:"v-model",value:t.activeBatchStamperParameters[e.field],expression:"activeBatchStamperParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType,checkboxInput:"checkbox"===e.inputType,disabled:e.isEnabled&&!e.isEnabled()},attrs:{readonly:e.isEnabled&&!e.isEnabled(),type:e.inputType},domProps:{value:t.activeBatchStamperParameters[e.field]},on:{change:function(i){return t.updateBatchStamperParameter(e,i)},input:function(i){i.target.composing||t.$set(t.activeBatchStamperParameters,e.field,i.target.value)}}})])})),0)]):t._e(),null!==t.entity||t.entities.length>0?i("div",{staticClass:"container",class:{collapsed:t.containerCollapsed.entityParameters}},[i("div",{staticClass:"header"},[i("div",{staticClass:"caret",on:{click:function(e){return t.toggleCollapseState("entityParameters")}}},[t.containerCollapsed.entityParameters?i("i",{staticClass:"fas fa-caret-right"}):i("i",{staticClass:"fas fa-caret-down"})]),i("div",{staticClass:"title"},[t._v(t._s(null!==t.entity?"Parameters":"Multi Parameters"))])]),i("div",{staticClass:"content"},t._l(t.entityParametersList,(function(e,s){return i("div",{key:"entity_parameter_"+s,staticClass:"row"},[i("div",{staticClass:"label"},[t._v(t._s(e.label)+":")]),"checkbox"===e.inputType?i("input",{directives:[{name:"model",rawName:"v-model",value:t.entityParameters[e.field],expression:"entityParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType},attrs:{placeholder:e.placeholder,type:"checkbox"},domProps:{checked:Array.isArray(t.entityParameters[e.field])?t._i(t.entityParameters[e.field],null)>-1:t.entityParameters[e.field]},on:{change:[function(i){var s=t.entityParameters[e.field],a=i.target,n=!!a.checked;if(Array.isArray(s)){var o=null,r=t._i(s,o);a.checked?r<0&&t.$set(t.entityParameters,e.field,s.concat([o])):r>-1&&t.$set(t.entityParameters,e.field,s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.entityParameters,e.field,n)},function(i){return t.updateEntityParameter(e,i)}]}}):"radio"===e.inputType?i("input",{directives:[{name:"model",rawName:"v-model",value:t.entityParameters[e.field],expression:"entityParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType},attrs:{placeholder:e.placeholder,type:"radio"},domProps:{checked:t._q(t.entityParameters[e.field],null)},on:{change:[function(i){return t.$set(t.entityParameters,e.field,null)},function(i){return t.updateEntityParameter(e,i)}]}}):i("input",{directives:[{name:"model",rawName:"v-model",value:t.entityParameters[e.field],expression:"entityParameters[parameter.field]"}],staticClass:"value",class:{textInput:"number"===e.inputType||"text"===e.inputType},attrs:{placeholder:e.placeholder,type:e.inputType},domProps:{value:t.entityParameters[e.field]},on:{change:function(i){return t.updateEntityParameter(e,i)},input:function(i){i.target.composing||t.$set(t.entityParameters,e.field,i.target.value)}}})])})),0)]):t._e()])])},zt=[],jt=(i("b680"),i("25f0"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"sceneInspector"},[i("div",{staticClass:"filter"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.filter,expression:"filter"}],attrs:{type:"text",placeholder:"filter"},domProps:{value:t.filter},on:{input:function(e){e.target.composing||(t.filter=e.target.value)}}}),i("div",{staticClass:"clear",attrs:{title:"Remove Filter"},on:{click:function(e){t.filter=""}}},[t._v(" ✕ ")])]),i("div",{staticClass:"list"},[i("div",{staticClass:"entitiesList"},t._l(t.entitiesInfo,(function(e,s){return i("div",{key:e.entity.id,staticClass:"entityItem",class:{odd:s%2!==0,child:e.isChild,frozen:e.entity.frozen,selected:e.selected}},[i("div",{staticClass:"info"},[i("div",{staticClass:"connection",class:{hasCaret:e.isGroup,collapsed:e.isCollapsed}},[e.isGroup?i("div",{staticClass:"caret",on:{click:function(i){return t.toggleCollapseState(e)}}},[e.isCollapsed?i("i",{staticClass:"fas fa-caret-right"}):i("i",{staticClass:"fas fa-caret-down"})]):t._e(),i("div",{staticClass:"verticalLine"}),i("div",{staticClass:"horizontalLine"})]),i("div",{staticClass:"visibility",on:{click:function(i){return t.toggleVisibility(e.entity.id)}}},[e.entity.visible?i("i",{staticClass:"far fa-eye"}):i("i",{staticClass:"far fa-eye-slash"})]),i("div",{staticClass:"name",on:{click:function(i){return t.selectEntity(e.entity,i)}}},[t._v(" "+t._s(e.entity.name)+" ")]),i("div",{staticClass:"frozen",on:{click:function(i){return t.toggleFrozenbility(e.entity.id)}}},[i("i",{staticClass:"far fa-snowflake"})])])])})),0)])])}),Dt=[],It={name:"SceneInspector",props:["editingGroup","selectedEntities"],data:function(){return{groupCollapsed:{},filter:""}},computed:{entitiesInfo:function(){var t=this;if(!this.editingGroup)return[];var e,i=[],s=this.filter.toLowerCase(),a=Object(C["a"])(this.editingGroup.children);try{var n=function(){var a=e.value,n={entity:a,selected:!!t.selectedEntities.find((function(t){return t.id===a.id}))};if(s){var o=a.name.toLowerCase();if("group"===a.type){n.isGroup=!0,n.isCollapsed=t.groupCollapsed[a.id];var r,l=i.length,c=Object(C["a"])(a.children);try{var h=function(){var e=r.value;-1!==e.name.toLowerCase().indexOf(s)&&i.push({entity:e,isChild:!0,selected:!!t.selectedEntities.find((function(t){return t.id===e.id}))})};for(c.s();!(r=c.n()).done;)h()}catch(m){c.e(m)}finally{c.f()}l!==i.length?(n.isCollapsed&&(n.isCollapsed=!1),i.splice(l,0,n)):-1!==o.indexOf(s)&&(n.isGroup=!1,i.push(n))}else-1!==o.indexOf(s)&&i.push(n)}else if("group"===a.type){var d=!!S.a.isUndefined(t.groupCollapsed[a.id])||t.groupCollapsed[a.id];if(i.push({isCollapsed:d,isGroup:!0,selected:n.selected,entity:n.entity}),!d){var u,f=Object(C["a"])(a.children);try{var p=function(){var e=u.value;i.push({entity:e,isChild:!0,selected:!!t.selectedEntities.find((function(t){return t.id===e.id}))})};for(f.s();!(u=f.n()).done;)p()}catch(m){f.e(m)}finally{f.f()}}}else i.push(n)};for(a.s();!(e=a.n()).done;)n()}catch(o){a.e(o)}finally{a.f()}return i}},methods:{selectEntity:function(t,e){if(e.ctrlKey){var i=!!this.selectedEntities.find((function(e){return e.id===t.id}));i?this.$emit("deselect-entities",[t]):this.$emit("select-entities",[t],!0)}else if(e.shiftKey){var s=[t];if(this.selectedEntities.length>0){for(var a=this.selectedEntities[this.selectedEntities.length-1],n=-1,o=-1,r=0;r<this.entitiesInfo.length;++r){var l=this.entitiesInfo[r];if(l.entity.id===a.id&&(n=r),l.entity.id===t.id&&(o=r),-1!==n&&-1!==o)break}if(-1!==n&&-1!==o){if(s=[],o<n){var c=n;n=o,o=c}for(var h=n;h<=o;++h)s.push(this.entitiesInfo[h].entity)}}this.$emit("select-entities",s)}else this.$emit("select-entities",[t])},toggleCollapseState:function(t){S.a.isUndefined(this.groupCollapsed[t.entity.id])?s["a"].set(this.groupCollapsed,t.entity.id,!1):s["a"].set(this.groupCollapsed,t.entity.id,!this.groupCollapsed[t.entity.id])},toggleVisibility:function(t){var e=this.editingGroup.findChildById(t);e&&e.setVisible(!e.visible)},toggleFrozenbility:function(t){var e=this.editingGroup.findChildById(t);e&&e.setFrozen(!e.frozen)}}},_t=It,Mt=(i("6518"),Object(h["a"])(_t,jt,Dt,!1,null,"0f6a8886",null)),At=Mt.exports,Ft={name:"commandPanel",props:["batchStamperParameters","editingGroup","selectedEntities"],components:{SceneInspector:At},data:function(){return{entity:null,entities:[],entityParameters:null,entityParametersList:[],activeBatchType:null,activeBatchStamperParameters:{},activeBatchStamperParametersList:[],containerCollapsed:{sceneInspector:!0},batchTypes:[{id:"free",name:"Free"},{id:"single",name:"Single"},{id:"line",name:"Line"},{id:"rectangle",name:"Rectangle"},{id:"triangle",name:"Triangle"},{id:"image",name:"Image"},{id:"ball",name:"Ball"},{id:"spiral",name:"Spiral",disabled:!0}]}},methods:{refresh:function(){if(this.entity){var t=Math.round(this.entity.position.x),e=Math.round(this.entity.position.z);this.entityParameters={name:this.entity.name,rotation:Math.round(k["q"].radToDeg(this.entity.getRotationY())%360),positionX:t===this.entity.position.x?t:this.entity.position.x.toFixed(2),positionZ:e===this.entity.position.z?e:this.entity.position.z.toFixed(2),color:this.entity.getColor()},"group"===this.entity.type&&(this.entityParameters.childrenPosX="",this.entityParameters.childrenPosZ="",this.entityParameters.childrenRot="",this.entityParameters.childrenColor="#ffffff")}else this.entities&&(this.entityParameters={rotation:"",positionX:"",positionY:"",color:"#ffffff"})},setEntities:function(t){this.entity=null,this.entities=[],0!==t.length&&(1===t.length?(this.entity=t[0],this.entityParametersList=[],this.entity&&(this.entityParametersList=[{field:"name",label:"Name",inputType:"text"}],"ground"===this.entity.type?this.entityParametersList.push({field:"color",label:"Color",inputType:"color"}):"group"===this.entity.type?(this.entityParametersList.push({field:"positionX",label:"X",inputType:"number"}),this.entityParametersList.push({field:"positionZ",label:"Z",inputType:"number"}),this.entityParametersList.push({field:"rotation",label:"Rotation",inputType:"number"}),this.entityParametersList.push({field:"childrenPosX",label:"Children Position X",placeholder:"Set Position X",inputType:"number"}),this.entityParametersList.push({field:"childrenPosZ",label:"Children Position Z",placeholder:"Set Position Z",inputType:"number"}),this.entityParametersList.push({field:"childrenRot",label:"Children Rotation",placeholder:"Set Rotation",inputType:"number"}),this.entityParametersList.push({field:"childrenColor",label:"Children Color",inputType:"color"})):"ball"===this.entity.type?(this.entityParametersList.push({field:"positionX",label:"X",inputType:"number"}),this.entityParametersList.push({field:"positionZ",label:"Z",inputType:"number"}),this.entityParametersList.push({field:"color",label:"Color",inputType:"color"})):(this.entityParametersList.push({field:"positionX",label:"X",inputType:"number"}),this.entity.userData.isFixed||(this.entityParametersList.push({field:"positionZ",label:"Z",inputType:"number"}),this.entityParametersList.push({field:"rotation",label:"Rotation",inputType:"number"})),this.entityParametersList.push({field:"color",label:"Color",inputType:"color"})))):(this.entities=t,this.entityParametersList=[{field:"positionX",label:"X",inputType:"number",placeholder:"Set Position X"},{field:"positionZ",label:"Z",inputType:"number",placeholder:"Set Position Z"},{field:"rotation",label:"Rotation",inputType:"number",placeholder:"Set Rotation"},{field:"color",label:"Color",inputType:"color"}]),this.refresh())},selectEntities:function(t,e){this.$emit("select-entities",t,e)},deselectEntities:function(t){this.$emit("deselect-entities",t)},selectBatchType:function(t){this.activeBatchType=t,this.activeBatchStamperParametersList=[];var e=this;if(t){switch(this.activeBatchStamperParameters=this.batchStamperParameters[t],t){case"single":this.activeBatchStamperParametersList=[{field:"rotation",label:"Rotation",inputType:"number"}];break;case"line":this.activeBatchStamperParametersList=[{field:"forwardOffset",label:"Forward Offset",inputType:"number"},{field:"fixedRotation",label:"Fixed Rotation",inputType:"checkbox"},{field:"rotation",label:"Children Rotation",inputType:"number",isEnabled:function(){return e.activeBatchStamperParameters.fixedRotation}}];break;case"free":this.activeBatchStamperParametersList=[{field:"forwardOffset",label:"Forward Offset",inputType:"number"},{field:"fixedRotation",label:"Fixed Rotation",inputType:"checkbox"},{field:"rotation",label:"Rotation",inputType:"number",isEnabled:function(){return e.activeBatchStamperParameters.fixedRotation}}];break;case"triangle":this.activeBatchStamperParametersList=[{field:"forwardOffset",label:"Forward Offset",inputType:"number"},{field:"rightOffset",label:"Right Offset",inputType:"number"},{field:"fixedRotation",label:"Fixed Rotation",inputType:"checkbox"},{field:"rotation",label:"Children Rotation",inputType:"number",isEnabled:function(){return e.activeBatchStamperParameters.fixedRotation}}];break;case"rectangle":this.activeBatchStamperParametersList=[{field:"forwardOffset",label:"Forward Offset",inputType:"number"},{field:"rightOffset",label:"Right Offset",inputType:"number"},{field:"rotation",label:"Children Rotation",inputType:"number"}];break;case"image":this.activeBatchStamperParametersList=[{field:"filename",label:"Image",inputType:"image"},{field:"forwardOffset",label:"Forward Offset",inputType:"number"},{field:"rightOffset",label:"Right Offset",inputType:"number"},{field:"rotation",label:"Children Rotation",inputType:"number"},{field:"horSize",label:"Horizontal Size",inputType:"number"},{field:"verSize",label:"Vertical Size",inputType:"number"}];break}"image"!==t&&this.activeBatchStamperParametersList.push({field:"color",label:"single"!==t&&"ball"!==t?"Children Color":"Color",inputType:"color"}),this.$emit("batch-stamper-on",t)}else this.activeBatchStamperParametersList=[],this.activeBatchStamperParameters={},this.$emit("batch-stamper-off")},updateEntityParameter:function(t,e){var i=e.target.value;switch(t.field){case"name":i?this.entity.name=i:e.target.value=this.entity.name;break;case"rotation":""!==i?this.$emit("rotate-selected-entities",k["q"].degToRad(parseFloat(i))):e.target.value=Math.round(k["q"].radToDeg(this.entity.getRotationY())%360);break;case"positionX":""!==i?this.$emit("move-selected-entities",{x:parseFloat(i)}):e.target.value=this.entity.position.x;break;case"positionZ":""!==i?this.$emit("move-selected-entities",{z:parseFloat(i)}):e.target.value=this.entity.position.z;break;case"color":this.$emit("colorize-selected-entities",i);break;case"childrenPosX":""!==i&&this.$emit("move-group-entities",this.entity,{x:parseFloat(i)}),e.target.value="";break;case"childrenPosZ":""!==i&&this.$emit("move-group-entities",this.entity,{z:parseFloat(i)}),e.target.value="";break;case"childrenRot":""!==i&&this.$emit("rotate-group-entities",this.entity,k["q"].degToRad(parseFloat(i))),e.target.value="";break;case"childrenColor":""!==i&&this.$emit("colorize-group-entities",this.entity,i),e.target.value="";break}this.entities.length>0&&(e.target.value="")},color2Hex:function(t){var e,i=[],s=Object(C["a"])(t);try{for(s.s();!(e=s.n()).done;){var a=e.value,n=a.toString(16);1===n.length&&(n="0"+n),i.push(n)}}catch(o){s.e(o)}finally{s.f()}return"#".concat(i[0]).concat(i[1]).concat(i[2])},loadFile:function(t){var e=t.target.files[0],i=new FileReader,s=this;i.onload=function(){s.activeBatchStamperParameters.filename=e.name,s.activeBatchStamperParameters.rawData=i.result,S.a.delay((function(){var t=s.$refs.image[0],e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height);for(var i=[],a=e.getContext("2d").getImageData(0,0,t.width,t.height).data,n=0;n<a.length;n+=4)i.push(s.color2Hex([a[n],a[n+1],a[n+2]]));s.activeBatchStamperParameters.width=t.width,s.activeBatchStamperParameters.height=t.height,s.activeBatchStamperParameters.data=i,s.$emit("rebuild-batch-stamper")}),100)},i.readAsDataURL(e)},onBatchStamperParameterClick:function(t){"filename"===t.field&&this.$refs.fileSelector.click()},updateBatchStamperParameter:function(t,e){"number"===t.inputType&&(this.activeBatchStamperParameters[t.field]=parseFloat(e.target.value),"horSize"===t.field||"verSize"===t.field?this.activeBatchStamperParameters[t.field]=Math.min(Math.max(this.activeBatchStamperParameters[t.field],1),30):"rotation"===t.field&&(this.activeBatchStamperParameters[t.field]=this.activeBatchStamperParameters[t.field])),this.$emit("rebuild-batch-stamper","color"===t.inputType)},toggleCollapseState:function(t){s["a"].set(this.containerCollapsed,t,!this.containerCollapsed[t])}}},Rt=Ft,$t=(i("3844"),Object(h["a"])(Rt,Bt,zt,!1,null,"ee80b988",null)),Vt=$t.exports,Lt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mask",on:{click:function(t){t.stopPropagation()}}},[i("div",{staticClass:"ioDialog",class:t.type},[i("div",{staticClass:"title"},[t._v(t._s(t.title))]),"load"===t.type?i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],ref:"input",staticClass:"input center",attrs:{type:"text",placeholder:"Enter Board UUID"},domProps:{value:t.input},on:{input:function(e){e.target.composing||(t.input=e.target.value)}}})]):"message"===t.type?i("div",[i("div",{staticClass:"message"},[t._v(t._s(t.message))])]):t._e(),i("div",{staticClass:"footer"},["message"!==t.type?i("div",{staticClass:"button",on:{click:t.cancel}},[t._v("Cancel")]):t._e(),t.noButton?t._e():i("div",{staticClass:"button",on:{click:t.accept}},[t._v("Accept")])])])])},Wt=[],Gt={name:"IODialog",data:function(){return{type:null,title:"",message:"",input:"",noButton:!1}},methods:{open:function(t,e){var i=this;switch(t){case"load":this.input="",this.title="Load Board",s["a"].nextTick((function(){return i.$refs.input.focus()}));break;case"message":this.title=e.type,this.message=e.message,this.noButton=e.noButton;break}this.type=t},close:function(){this.$emit("close")},accept:function(){var t=null;switch(this.type){case"load":this.input&&(t={uuid:this.input});break}this.$emit("close",this.type,t)},cancel:function(){this.$emit("close",this.type)}}},Nt=Gt,Ut=(i("7c18"),Object(h["a"])(Nt,Lt,Wt,!1,null,null,null)),Yt=Ut.exports,qt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mask",on:{click:function(t){t.stopPropagation()}}},[i("div",{staticClass:"publishDialog"},[i("div",{staticClass:"title"},[t._v("Publish Board")]),i("div",{staticClass:"form"},[i("div",{staticClass:"row"},[i("div",{staticClass:"label"},[t._v("Title:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],ref:"title",attrs:{type:"text",maxlength:t.maxTitleLength},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),i("div",{staticClass:"row"},[i("div",{staticClass:"label"},[t._v("Author:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.author,expression:"author"}],attrs:{type:"text",maxlength:t.maxAuthorLength},domProps:{value:t.author},on:{input:function(e){e.target.composing||(t.author=e.target.value)}}})])]),t._m(0),i("div",{staticClass:"footer"},[i("div",{staticClass:"btn",on:{click:t.cancel}},[t._v("Cancel")]),i("div",{staticClass:"btn accept",on:{click:t.accept}},[t._v("Accept")])])])])},Zt=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"recaptchaMessage"},[t._v(" This site is protected by reCAPTCHA and the Google "),i("a",{attrs:{href:"https://policies.google.com/privacy"}},[t._v("Privacy Policy")]),t._v(" and "),i("a",{attrs:{href:"https://policies.google.com/terms"}},[t._v("Terms of Service")]),t._v(" apply. ")])}],Ht={name:"PublishDialog",data:function(){return{title:"New Board",author:"New Author",maxTitleLength:W,maxAuthorLength:G}},methods:{open:function(){var t=this;s["a"].nextTick((function(){t.$refs.title.focus(),t.$refs.title.select()}))},cancel:function(){this.$emit("close",null,null)},accept:function(){var t=this;this.$recaptcha("publish_scene").then((function(e){t.$emit("close",t.title,t.author,e)}))}}},Qt=Ht,Xt=(i("06d2"),Object(h["a"])(Qt,qt,Zt,!1,null,null,null)),Kt=Xt.exports,Jt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mask",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"helpDialog"},[s("div",{staticClass:"closeButton",on:{click:t.close}},[t._v("🗙")]),s("div",{staticClass:"step"},[1===t.activeStep?s("div",{staticClass:"step1"},[s("img",{staticClass:"animation",attrs:{src:i("cbbe")}}),s("div",{staticClass:"title"},[t._v("Domino Party")]),s("div",{staticClass:"description"},[t._v("Use the tools in the editor to populate your one square meter board with domino tiles and balls, make it as good as you can and share it with the world!")])]):2===t.activeStep?s("div",{staticClass:"step2"},[s("div",{staticClass:"title"},[t._v("Interface")]),t._m(0)]):t._e()]),s("div",{staticClass:"controls"},[s("div",{staticClass:"leftArrow",on:{click:function(e){return t.incStep(-1)}}}),t._l(t.numSteps,(function(e){return s("div",{key:e,staticClass:"step",class:{active:t.activeStep===e},on:{click:function(i){return t.setStep(e)}}})})),s("div",{staticClass:"rightArrow",on:{click:function(e){return t.incStep(1)}}})],2),s("div",{staticClass:"checkboxContainer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.showDialogAtStartup,expression:"showDialogAtStartup"}],staticClass:"checkboxInput",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.showDialogAtStartup)?t._i(t.showDialogAtStartup,null)>-1:t.showDialogAtStartup},on:{change:[function(e){var i=t.showDialogAtStartup,s=e.target,a=!!s.checked;if(Array.isArray(i)){var n=null,o=t._i(i,n);s.checked?o<0&&(t.showDialogAtStartup=i.concat([n])):o>-1&&(t.showDialogAtStartup=i.slice(0,o).concat(i.slice(o+1)))}else t.showDialogAtStartup=a},t.updateShowDialogAtStartup]}}),s("div",[t._v("Show this Welcome Screen at startup")])])])])},te=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("div",[t._v("CAMERA")]),i("ul",[i("li",[t._v("Mouse right button: Pan.")]),i("li",[t._v("Mouse middle button: Zoom.")]),i("li",[t._v("Ctrl + mouse right button: Rotate.")])]),i("div",[t._v("STAMPER MODE")]),i("ul",[i("li",[t._v("Single, Ball, Image: Left click on the board to put the element in the selected position.")]),i("li",[t._v("Free, Line, Rectangle, Triangle: Left click on the board to select the starting position. Move the mouse and click again to select the ending position. ")]),i("li",[t._v("Right click to exit the stamper mode.")])]),i("div",[t._v("SELECTION")]),i("ul",[i("li",[t._v("Elements can't be selected in stamper mode.")]),i("li",[t._v("Left click on an element (tile or ball) to select it.")]),i("li",[t._v("Ctrl + left click on an element to add it to the current selection.")]),i("li",[t._v("Shift + left click on an element to select its parent.")]),i("li",[t._v("Left button down and drag mouse = multi selection.")]),i("li",[t._v("Selected elements will be show with a fading color animation.")])]),i("div",[t._v("BOARD INSPECTOR")]),i("ul",[i("li",[t._v("Left click to select.")]),i("li",[t._v("Ctrl + left click to add element to selection.")]),i("li",[t._v("Shift + left click to selection by range.")]),i("li",[t._v("Click the eye icon to hide/display the element.")]),i("li",[t._v("Click the snowflake icon to frozen/unfrozen the element. This means it can be moved/rotated.")])])])}],ee={name:"HelpDialog",data:function(){return{activeStep:2,numSteps:2,showDialogAtStartup:!1}},methods:{open:function(){this.activeStep=1;var t=window.localStorage.getItem("showDialogAtStartup");t&&"true"!==t||(this.showDialogAtStartup=!0)},close:function(){this.$emit("close")},updateShowDialogAtStartup:function(t){this.showDialogAtStartup=t.target.checked,window.localStorage.setItem("showDialogAtStartup",this.showDialogAtStartup)},incStep:function(t){this.setStep(this.activeStep+t)},setStep:function(t){this.activeStep=t,this.activeStep>this.numSteps?this.activeStep=1:this.activeStep<1&&(this.activeStep=this.numSteps)}}},ie=ee,se=(i("65fe"),Object(h["a"])(ie,Jt,te,!1,null,null,null)),ae=se.exports,ne=300,oe=1500,re=.5,le={x:-90,y:80,z:0},ce={name:"Editor",components:{CommandPanel:Vt,IODialog:Yt,PublishDialog:Kt,HelpDialog:ae},data:function(){return{maxNumEntitiesInScene:oe,batchStamper:new Et,selectedEntities:[],activeTransform:"select",state:"idle",stateBeforePause:null,actionsQueue:{queue:[],idx:0},dialogVisible:null,dialogEntities:null,sceneUuid:null,world:null,batchId:0,selectionBox:null}},computed:{numValidEntitiesInTheScene:function(){return this.world?this.getNumValidEntitiesInGroup(this.world.group):0}},mounted:function(){this.world=new St({domElement:this.$refs.scene,cameraPosition:{x:-90,y:80,z:0},numTiles:z,numBalls:z,numGrounds:1}),this.orbitControl=new O["a"](this.world.camera,this.world.renderer.domElement),this.orbitControl.mouseButtons.LEFT=-1,this.orbitControl.maxDistance=200,this.transformControlEnabled=!1,this.transformControl=new B["a"](this.world.camera,this.world.renderer.domElement),this.selectTransform(this.activeTransform),this.colorFadingTimer=re/2,this.raycaster=new k["B"],this.world.scene.add(this.transformControl),this.batchStamper.init(this),this.ground=new wt({name:"Ground",iMesh:this.world.imGrounds,color:4473924}),this.executeAction(H,{group:this.world.group,entities:[this.ground]},!0);for(var t=[],e=0,i=[-50,50];e<i.length;e++){var s=i[e];t.push(new Pt({name:"Tile",position:new k["I"](0,A,s),iMesh:this.world.imTiles,userData:{isFixed:!0},color:175269}))}this.executeAction(H,{group:this.world.group,entities:t},!0),this.initialDummyPosition=new k["I"],this.prevDummyPosition=new k["I"],this.dummyObject=new k["v"],this.world.scene.add(this.dummyObject),this.animFrameId=window.requestAnimationFrame(this.tick),this.start=Date.now(),this.shortcuts=new Ot(this),this.manageTransformControlEvents();var a=window.localStorage.getItem("showDialogAtStartup");a&&"true"!==a||this.openHelpDialog();var n=this;window.addEventListener("resize",(function(){n.world.onWindowResize()}),!1)},destroyed:function(){this.shortcuts.onDestroyed(),this.animFrameId&&window.cancelAnimationFrame(this.animFrameId)},methods:{manageTransformControlEvents:function(){var t=this;this.transformControl.addEventListener("dragging-changed",(function(e){if(!t.batchStamper.active&&(t.orbitControl.enabled=!e.value,t.transformControlEnabled=e.value,e.value)){if("translate"===e.target.mode&&t.shortcuts.isKeyPressed("Shift")){var i,s={},a={},n=[],o=Object(C["a"])(t.selectedEntities);try{for(o.s();!(i=o.n()).done;){var r=i.value;if(!r.userData.isFixed&&!r.frozen&&("tile"===r.type||"group"===r.type)){var l=r.clone();r.parent.id in s||(s[r.parent.id]=[],a[r.parent.id]=r.parent),s[r.parent.id].push(l),n.push(l)}}}catch(p){o.e(p)}finally{o.f()}var c=[];for(var h in s)c.push(new H({group:a[h],entities:s[h]},t));c.push(new J({entities:n},t)),t.executeAction(et,{actions:c})}t.initialDummyPosition.copy(t.dummyObject.position),t.prevDummyPosition.copy(t.initialDummyPosition),t.prevDummyRotation=0,t.accumRotation=0,t.initialTransformValues=[];var d,u=Object(C["a"])(t.selectedEntities);try{for(u.s();!(d=u.n()).done;){var f=d.value;t.initialTransformValues.push({position:f.position.clone(),rotation:f.angleY})}}catch(p){u.e(p)}finally{u.f()}}})),this.transformControl.addEventListener("objectChange",(function(e){if(!t.batchStamper.active){switch(e.target.mode){case"translate":e.target.object.position.y=t.prevDummyPosition.y;var i=e.target.object.position.clone();i.sub(t.prevDummyPosition);var s,a=Object(C["a"])(t.selectedEntities);try{for(a.s();!(s=a.n()).done;){var n=s.value;n.frozen?(i.x=0,i.z=0):n.userData.isFixed&&(i.z=0),n.move(i.x,i.y,i.z)}}catch(h){a.e(h)}finally{a.f()}t.prevDummyPosition.copy(e.target.object.position);break;case"rotate":var o,r=e.target.rotationAngle-t.prevDummyRotation,l=Object(C["a"])(t.selectedEntities);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.userData.isFixed||c.frozen||c.rotate(r)}}catch(h){l.e(h)}finally{l.f()}t.prevDummyRotation=e.target.rotationAngle,t.accumRotation+=r;break}t.$refs.commandPanel.refresh()}})),this.transformControl.addEventListener("mouseUp",(function(e){if(!t.batchStamper.active)switch(e.target.mode){case"translate":var i=t.dummyObject.position.clone();if(i.sub(t.initialDummyPosition),i.y=0,i.lengthSq()>0){for(var s=[],a=[],n=0;n<t.selectedEntities.length;++n){var o=t.selectedEntities[n],r=t.initialTransformValues[n].position;o.setPosition(r.x,r.y,r.z),o.frozen||(o.userData.isFixed?0!==i.x&&s.push(o):a.push(o))}if(a.length===t.selectedEntities.length)t.executeAction(Q,{offset:i,entities:a});else{var l=i.clone();if(l.z=0,s.length===t.selectedEntities.length)t.executeAction(Q,{offset:l,entities:s});else{var c=[];a.length>0&&c.push(new Q({offset:i,entities:a},this)),s.length>0&&c.push(new Q({offset:l,entities:s},this)),c.length>0&&t.executeAction(et,{actions:c})}}}break;case"rotate":var h=t.accumRotation;if(0!==h){for(var d=[],u=0;u<t.selectedEntities.length;++u){var f=t.selectedEntities[u];f.userData.isFixed||f.frozen||(f.rotate(t.initialTransformValues[u].rotation-f.angleY),d.push(f))}t.executeAction(X,{offset:h,entities:d})}break}}))},tick:function(){var t=Date.now(),e=(t-this.start)/1e3;if(this.start=t,"idle"!==this.state&&"paused"!==this.state&&this.world.tick(e),"idle"===this.state&&this.selectEntities.length>0){this.colorFadingTimer=(this.colorFadingTimer+e)%(re+re);var i,s=Math.abs(this.colorFadingTimer-re),a=Object(C["a"])(this.selectedEntities);try{for(a.s();!(i=a.n()).done;){var n=i.value;"group"!==n.type&&n.setFadingIntensity(s)}}catch(o){a.e(o)}finally{a.f()}}"validating"===this.state&&this.checkSceneValidation(),this.batchStamper.render(),this.world.render(),this.animFrameId=window.requestAnimationFrame(this.tick)},adjustDummyToSelectedEntities:function(){if(this.selectedEntities.length>0&&this.transformControl.object){var t,e=0,i=0,s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(t=s.n()).done;){var a=t.value,n=a.getWorldPosition();e+=n.x,i+=n.z}}catch(r){s.e(r)}finally{s.f()}var o=this.selectedEntities.length;this.dummyObject.position.set(e/o,0,i/o)}},selectEntities:function(t,e){var i,s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(i=s.n()).done;){var a=i.value;"group"!==a.type&&a.setFadingIntensity(0)}}catch(v){s.e(v)}finally{s.f()}if(this.selectedEntities=e?this.selectedEntities.concat(t):S.a.clone(t),this.$refs.commandPanel.setEntities(this.selectedEntities),this.selectedEntities.length>0){var n,o=Object(C["a"])(this.selectedEntities);try{for(o.s();!(n=o.n()).done;){var r=n.value;r.originalColor=r.color}}catch(v){o.e(v)}finally{o.f()}switch(this.activeTransform){case"translate":var l,c=!1,h=Object(C["a"])(this.selectedEntities);try{for(h.s();!(l=h.n()).done;){var d=l.value;if(!d.userData.isFixed){c=!0;break}}}catch(v){h.e(v)}finally{h.f()}this.transformControl.showZ=c;break;case"rotate":var u,f=!0,p=Object(C["a"])(this.selectedEntities);try{for(p.s();!(u=p.n()).done;){var m=u.value;if(!m.userData.isFixed){f=!1;break}}}catch(v){p.e(v)}finally{p.f()}this.transformControl.showX=!1,this.transformControl.showY=!0,this.transformControl.showZ=!1,this.transformControl.enabled=!f;break}1===this.selectedEntities.length&&"ground"===this.selectedEntities[0].type&&(this.transformControl.enabled=!1),this.transformControl.attach(this.dummyObject),this.adjustDummyToSelectedEntities()}else this.transformControl.detach()},deselectEntities:function(t){var e=t.map((function(t){return t.id}));this.selectEntities(this.selectedEntities.filter((function(t){return-1===e.indexOf(t.id)})))},onMouseMove:function(t){if(this.batchStamper.onMouseMove(t),this.selectionBox&&!this.transformControlEnabled){if(this.selectionBox.leftDirection?this.selectionBox.left=t.clientX:this.selectionBox.right=t.clientX,this.selectionBox.right<this.selectionBox.left){var e=this.selectionBox.right;this.selectionBox.right=this.selectionBox.left,this.selectionBox.left=e,this.selectionBox.leftDirection=!this.selectionBox.leftDirection}if(this.selectionBox.topDirection?this.selectionBox.top=t.clientY:this.selectionBox.bottom=t.clientY,this.selectionBox.bottom<this.selectionBox.top){var i=this.selectionBox.top;this.selectionBox.top=this.selectionBox.bottom,this.selectionBox.bottom=i,this.selectionBox.topDirection=!this.selectionBox.topDirection}this.selectionBox.width=this.selectionBox.right-this.selectionBox.left,this.selectionBox.height=this.selectionBox.bottom-this.selectionBox.top}},onMouseDown:function(t){switch(t.which){case 1:"idle"===this.state&&(this.clickStart=Date.now()),this.batchStamper.active||this.transformControlEnabled||"idle"!==this.state||(this.selectionBox={top:t.clientY,left:t.clientX,width:0,height:0});break;case 3:this.batchStamper.active&&this.$refs.commandPanel.selectBatchType(null);break}},onMouseUp:function(t){if("idle"===this.state&&1===t.which&&!this.ignoreNextMouseUpEvent){var e=Date.now()-this.clickStart;if(e<=ne)if(this.batchStamper.active){var i=this.batchStamper.onMouseUp(t);i&&(this.createBatch(i.x,i.z),this.batchStamper.reset())}else{var s=this.getEntityHit(t.offsetX,t.offsetY);if(s)if(t.ctrlKey){var a=!!this.selectedEntities.find((function(t){return t.id===s.id}));a?this.onDeselectEntities([s]):this.onSelectEntities([s],!0)}else t.shiftKey&&s.parent.parent?this.onSelectEntities([s.parent]):this.onSelectEntities([s]);else this.onSelectEntities([])}else if(!this.transformControlEnabled&&this.selectionBox){var n=this.getBoxedSelectedEntities(this.world.group);this.onSelectEntities(n)}this.selectionBox=null}},getBoxedSelectedEntities:function(t){var e,i=[],s=this.selectionBox,a=Object(C["a"])(t.children);try{for(a.s();!(e=a.n()).done;){var n=e.value;if("group"===n.type)i=i.concat(this.getBoxedSelectedEntities(n));else if("ground"!==n.type){var o=n.getWorldPosition();o.project(this.world.camera),o.x=(o.x+1)*this.$refs.scene.clientWidth/2,o.y=-(o.y-1)*(this.$refs.scene.clientHeight/2)+this.$refs.scene.offsetTop,o.x>=s.left&&o.x<=s.right&&o.y>=s.top&&o.y<=s.bottom&&i.push(n)}}}catch(r){a.e(r)}finally{a.f()}return i},prepareGroupToPlay:function(t){var e,i=Object(C["a"])(t.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;"group"===s.type?this.prepareGroupToPlay(s):this.isEntityValidToBePublished(s)?s.addToPhysicalWorld(this.world):(s.setVisible(!1),s.hiddenByPlay=!0)}}catch(a){i.e(a)}finally{i.f()}},restoreGroupToEdit:function(t){var e,i=Object(C["a"])(t.children);try{for(i.s();!(e=i.n()).done;){var s=e.value;"group"===s.type?this.restoreGroupToEdit(s):s.hiddenByPlay&&s.setVisible(!0)}}catch(a){i.e(a)}finally{i.f()}},play:function(t){if("idle"===this.state&&(!t||1===this.selectedEntities.length&&"tile"===this.selectedEntities[0].type)){var e=t?this.selectedEntities[0]:this.world.group.children[j];this.prePlaySelectedEntities=S.a.clone(this.selectedEntities),this.state=t?"playingFromSelection":"playing",this.world.group.saveState(),this.prepareGroupToPlay(this.world.group),this.selectEntities([]);var i=e.getWorldRotationY(),s=R,a=s*Math.sin(i),n=s*Math.cos(i);return S.a.delay((function(){e.body.applyImpulse(new T.a.btVector3(a,0,n))}),200),this.world.group.children[D]}},stop:function(){"idle"!==this.state&&(this.world.group.removeFromPhysicalWorld(this.world),this.restoreGroupToEdit(this.world.group),this.world.group.restoreState(),this.selectEntities(this.prePlaySelectedEntities),this.prePlaySelectedEntities=null,this.state="idle")},togglePause:function(){"paused"===this.state?this.state=this.stateBeforePause:(this.stateBeforePause=this.state,this.state="paused")},stepForward:function(){this.world.tick(.016)},executeAction:function(t,e,i){if("idle"===this.state){var a=new t(e,this);a.do(),i||(this.actionsQueue.idx<this.actionsQueue.queue.length&&this.actionsQueue.queue.splice(this.actionsQueue.idx,this.actionsQueue.queue.length-this.actionsQueue.idx),this.actionsQueue.queue.push(a),s["a"].set(this.actionsQueue,"idx",this.actionsQueue.queue.length))}},undoAction:function(){if("idle"===this.state&&this.actionsQueue.idx>0){s["a"].set(this.actionsQueue,"idx",this.actionsQueue.idx-1);var t=this.actionsQueue.queue[this.actionsQueue.idx];t.undo(),this.adjustDummyToSelectedEntities(),this.$refs.commandPanel.refresh()}},redoAction:function(){if("idle"===this.state&&this.actionsQueue.idx<this.actionsQueue.queue.length){var t=this.actionsQueue.queue[this.actionsQueue.idx];t.redo(),this.adjustDummyToSelectedEntities(),s["a"].set(this.actionsQueue,"idx",this.actionsQueue.idx+1),this.$refs.commandPanel.refresh()}},onSelectEntities:function(t,e){this.executeAction(J,{entities:t,adding:e})},onDeselectEntities:function(t){this.executeAction(tt,{entities:t})},onBatchStamperOn:function(t){s["a"].set(this.batchStamper,"active",!0),this.batchStamper.setType(t),this.batchStamper.reset(),this.selectEntities([])},onBatchStamperOff:function(){s["a"].set(this.batchStamper,"active",!1),this.batchStamper.show(!1)},removeSelectedEntities:function(){if("idle"===this.state&&this.selectedEntities.length>0){var t,e=[],i={},s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(t=s.n()).done;){var a=t.value;if(!a.userData.isFixed&&!a.frozen){var n=this.world.group;a.parent&&(n=a.parent),n.id in i||(i[n.id]=[]),i[n.id].push(a)}}}catch(r){s.e(r)}finally{s.f()}for(var o in i)i[o].length>0&&e.push(new K({group:i[o][0].parent,entities:i[o]}));this.executeAction(et,{actions:e})}new K},createBatch:function(t,e){if("image"!==this.batchStamper.type||this.batchStamper.parameters.image.data){var i=null;if("single"!==this.batchStamper.type&&"ball"!==this.batchStamper.type){var s=this.batchStamper.type[0].toUpperCase()+this.batchStamper.type.slice(1);i=new bt({name:"".concat(s,"_").concat(this.batchId++),position:new k["I"](t,0,e)})}var a=this.batchStamper.createEntitiesFromStamper(this.world,i);this.executeAction(H,{group:this.world.group,entities:i?[i]:a})}},selectTransform:function(t){if("idle"===this.state){switch(this.activeTransform=t,t){case"select":this.transformControl.setMode("translate"),this.transformControl.enabled=!1,this.transformControl.showX=!1,this.transformControl.showY=!1,this.transformControl.showZ=!1;break;case"translate":if(this.transformControl.setMode(t),this.transformControl.enabled=!0,this.transformControl.showX=!0,this.transformControl.showY=!1,this.transformControl.object){this.transformControl.showZ=!1;var e,i=Object(C["a"])(this.selectedEntities);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(!s.userData.isFixed){this.transformControl.showZ=!0;break}}}catch(r){i.e(r)}finally{i.f()}}break;case"rotate":if(this.transformControl.setMode(t),this.transformControl.enabled=!0,this.transformControl.showX=!1,this.transformControl.showY=!0,this.transformControl.showZ=!1,this.transformControl.object){this.transformControl.enabled=!1;var a,n=Object(C["a"])(this.selectedEntities);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(!o.userData.isFixed&&"ball"!==o.type){this.transformControl.enabled=!0;break}}}catch(r){n.e(r)}finally{n.f()}}break}1===this.selectedEntities.length&&"ground"===this.selectedEntities[0].type&&(this.transformControl.enabled=!1)}},rotateGroupEntities:function(t,e){var i,s=[],a=Object(C["a"])(t.children);try{for(a.s();!(i=a.n()).done;){var n=i.value;if(!n.frozen){var o=e-n.angleY;0!==o&&s.push(new X({offset:o,entities:[n]}))}}}catch(r){a.e(r)}finally{a.f()}s.length>0&&this.executeAction(et,{actions:s})},rotateSelectedEntities:function(t){var e,i=[],s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(!a.frozen&&!a.userData.isFixed){var n=t-a.angleY;0!==n&&i.push(new X({offset:n,entities:[a]}))}}}catch(o){s.e(o)}finally{s.f()}i.length>0&&(this.executeAction(et,{actions:i}),this.adjustDummyToSelectedEntities())},moveGroupEntities:function(t,e){var i,s=[],a=Object(C["a"])(t.children);try{for(a.s();!(i=a.n()).done;){var n=i.value;if(!n.frozen){var o={x:0,y:0,z:0};e.x&&(o.x=e.x-n.position.x),e.z&&(o.z=e.z-n.position.z),0===o.x&&0===o.z||s.push(new Q({offset:o,entities:[n]}))}}}catch(r){a.e(r)}finally{a.f()}s.length>0&&this.executeAction(et,{actions:s})},colorizeGroupEntities:function(t,e){var i,s=[],a=Object(C["a"])(t.children);try{for(a.s();!(i=a.n()).done;){var n=i.value;n.frozen||s.push(n)}}catch(o){a.e(o)}finally{a.f()}s.length>0&&this.executeAction(it,{entities:s,color:e})},colorizeSelectedEntities:function(t){var e,i=[],s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(e=s.n()).done;){var a=e.value;a.frozen||i.push(a)}}catch(n){s.e(n)}finally{s.f()}i.length>0&&this.executeAction(it,{entities:i,color:t})},moveSelectedEntities:function(t){var e,i=[],s=Object(C["a"])(this.selectedEntities);try{for(s.s();!(e=s.n()).done;){var a=e.value;if(!a.frozen){var n={x:0,y:0,z:0};S.a.isUndefined(t.x)||(n.x=t.x-a.position.x),S.a.isUndefined(t.z)||a.userData.isFixed||(n.z=t.z-a.position.z),0===n.x&&0===n.z||i.push(new Q({offset:n,entities:[a]}))}}}catch(o){s.e(o)}finally{s.f()}i.length>0&&(this.executeAction(et,{actions:i}),this.adjustDummyToSelectedEntities())},openIODialog:function(t,e){"idle"===this.state&&(this.dialogVisible="ioDialog",this.$refs.ioDialog.open(t,e))},openHelpDialog:function(){"idle"===this.state&&(this.dialogVisible="helpDialog",this.$refs.helpDialog.open())},closeHelpDialog:function(){this.dialogVisible=null},publishScene:function(){"idle"!==this.state||this.numValidEntitiesInTheScene>this.maxNumEntitiesInScene||(this.cameraPositionPreValidating=this.world.camera.position.clone(),this.cameraRotationPreValidating=this.world.camera.rotation.clone(),this.world.camera.position.set(le.x,le.y,le.z),this.world.camera.lookAt(new k["I"](0,0,0)),this.lastTileValidating=this.play(),this.state="validating")},saveEntities:function(t){var e,i=[],s=Object(C["a"])(t.children);try{for(s.s();!(e=s.n()).done;){var a=e.value,n=a.getWorldPosition(),o=a.angleY,r={type:a.type,position:{x:n.x,z:n.z},rotation:o,color:a.getColor(),visible:a.visible};"group"===a.type?i=i.concat(this.saveEntities(a)):i.push(r)}}catch(l){s.e(l)}finally{s.f()}return i},isEntityValidToBePublished:function(t){if(!t.visible)return!1;var e=t.getWorldPosition?t.getWorldPosition():t.position;return e.x>=-50&&e.x<=50&&e.z>=-50&&e.z<=50},checkSceneValidation:function(){"publishDialog"!==this.dialogVisible&&"falling"===this.lastTileValidating.state&&(this.stop(),this.dialogVisible="publishDialog",this.$refs.publishDialog.open())},cancelValidation:function(){this.stop(),this.world.camera.position.copy(this.cameraPositionPreValidating),this.world.camera.rotation.copy(this.cameraRotationPreValidating)},copySceneUrlToClipboard:function(){navigator.clipboard.writeText("https://malandrin.github.io/domino-party/#/view/".concat(this.sceneUuid))},closePublishDialog:function(t,e,i){if(this.dialogVisible=null,null!==t){var s,a=[],n=Object(C["a"])(this.saveEntities(this.world.group));try{for(n.s();!(s=n.n()).done;){var o=s.value;this.isEntityValidToBePublished(o)&&(delete o.visible,a.push(o))}}catch(c){n.e(c)}finally{n.f()}var r={title:(t||"New Board").substring(0,W),author:(e||"New Author").substring(0,G),content:JSON.stringify(a)},l=this;this.$http.post("scenes?token=".concat(i),r).then((function(t){l.$refs.ioDialog.close(),t.body.ok?(l.sceneUuid=t.body.uuid,l.openIODialog("message",{type:"info",message:"Board published! Use the top right button to share it."})):l.openIODialog("message",{type:"error",message:"Error publishing the board. Probably the server free tier daily quota is over."})})).catch((function(){l.openIODialog("message",{type:"error",message:"Error publishing the board. Probably the server free tier daily quota is over."})})),this.openIODialog("message",{type:"info",noButton:!0,message:"Publishing board..."})}},getNumValidEntitiesInGroup:function(t){var e,i=0,s=Object(C["a"])(t.children);try{for(s.s();!(e=s.n()).done;){var a=e.value;"group"!==a.type?this.isEntityValidToBePublished(a)&&++i:i+=this.getNumValidEntitiesInGroup(a)}}catch(n){s.e(n)}finally{s.f()}return i},getEntityHit:function(t,e){var i=0,s=null,a=new k["H"](t/this.$refs.scene.clientWidth*2-1,-e/this.$refs.scene.clientHeight*2+1);this.raycaster.setFromCamera(a,this.world.camera);var n,o=this.raycaster.intersectObject(this.world.imTiles.mesh).concat(this.raycaster.intersectObject(this.world.imBalls.mesh)),r=Object(C["a"])(o);try{for(r.s();!(n=r.n()).done;){var l=n.value;(l.distance<i||!s)&&(s=l,i=s.distance)}}catch(c){r.e(c)}finally{r.f()}return s?this.world.group.findChildByIMeshEntry(s.object.iMesh.name,s.instanceId):null},getGroundHitPoint:function(t,e){var i=0,s=null,a=new k["H"](t/this.$refs.scene.clientWidth*2-1,-e/this.$refs.scene.clientHeight*2+1);this.raycaster.setFromCamera(a,this.world.camera);var n,o=this.raycaster.intersectObject(this.world.imGrounds.mesh),r=Object(C["a"])(o);try{for(r.s();!(n=r.n()).done;){var l=n.value;(l.distance<i||!s)&&(s=l,i=s.distance)}}catch(c){r.e(c)}finally{r.f()}return s?s.point:null},rebuildBatchStamper:function(t){if(this.batchStamper.rebuild(),t){this.ignoreNextMouseUpEvent=t;var e=this;S.a.delay((function(){e.ignoreNextMouseUpEvent=!1}),200)}}}},he=ce,de=(i("72b7"),Object(h["a"])(he,w,x,!1,null,null,null)),ue=de.exports,fe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"viewer"},[t.activeScene?i("div",{staticClass:"sceneInfo"},[i("div",{staticClass:"title"},[t._v(t._s(t.activeScene.title))]),i("div",{staticClass:"author"},[t._v("by "+t._s(t.activeScene.author))])]):t._e(),i("div",{ref:"scene",staticClass:"scene"}),t.message?i("div",{staticClass:"message"},[t._v(" "+t._s(t.message)+" ")]):t._e()])},pe=[],me={x:-110,y:100,z:0},ve=.5,ye=0,be={name:"Viewer",data:function(){return{activeScene:null,message:"Loading. Please, wait..."}},mounted:function(){this.animFrameId=window.requestAnimationFrame(this.tick),this.start=Date.now(),this.scenePositionZ=-1e4,this.state="playing",this.timer=0,this.cameraDest=new k["I"](me.x,me.y,me.z+this.scenePositionZ),this.world=new St({domElement:this.$refs.scene,cameraPosition:this.cameraDest,numTiles:1e4,numBalls:5e3,numGrounds:10}),this.world.camera.lookAt(new k["I"](20,0,this.cameraDest.z)),this.activeScenes=[],this.activeSceneIdx=0,this.nextSceneDefs=[],this.loadedSceneId=this.$route.params.id;var t=this;this.fetchScenes(10,this.loadedSceneId,(function(){if(t.loadedSceneId)t.addNextSceneToWorld(!0,!1);else for(var e=0;e<4;++e)t.addNextSceneToWorld(e<2,!1);S.a.delay((function(){t.message=null}),2e3),S.a.delay((function(){t.activeSceneIdx=0,t.activeScene=t.activeScenes[t.activeSceneIdx],t.impulseTile(t.activeScene.initialTile)}),3e3)})),window.addEventListener("resize",(function(){t.world.onWindowResize()}),!1)},destroyed:function(){this.animFrameId&&window.cancelAnimationFrame(this.animFrameId)},methods:{fetchScenes:function(t,e,i){var s=this,a="scenes?";a+=e?"id=".concat(e):"count=".concat(t),this.$http.get(a).then((function(t){if(t.body.ok){var e,a=Object(C["a"])(t.body.scenes);try{for(a.s();!(e=a.n()).done;){var n=e.value;n.id=ye++,s.nextSceneDefs.push(n)}}catch(o){a.e(o)}finally{a.f()}i&&i()}else s.message="Error loading boards. Probably the server free tier daily quota is over."})).catch((function(){s.message="Error loading boards. Probably the server free tier daily quota is over."}))},tick:function(){var t=Date.now(),e=Math.min((t-this.start)/1e3,.016);if(this.start=t,this.world.tick(e),this.world.render(),this.activeScene&&!this.loadedSceneId){var i=this.activeSceneIdx+1,s=this.activeScenes[i];if("falling"===s.initialTile.state){var a=this.activeScenes[i+2];"streaming"===a.state&&this.streamScene(a,-1,this.activeScenes[i+1]),this.activeScene=s,this.activeSceneIdx=i;for(var n=0;n<=i-4;++n){var o=this.activeScenes.shift();o.group.removeFromRenderWorld(),o.group.removeFromPhysicalWorld(this.world),this.world.group.removeChild(o.group),--this.activeSceneIdx}this.activeScenes[this.activeSceneIdx+1].group.addToPhysicalWorld(this.world),this.addNextSceneToWorld(!1,!0)}else{var r=this.activeScenes[i+2];"streaming"===r.state&&this.streamScene(r,10,this.activeScenes[i+1])}var l=this.getLookAtZ();if(l){l>this.world.camera.position.z&&(this.cameraDest.z=l+me.z);var c=this.cameraDest.clone();c.sub(this.world.camera.position);var h=.8*c.length();c.normalize(),this.world.camera.position.z+=c.z*e*h,this.world.lightTarget.position.set(this.world.camera.position.x+90,0,this.world.camera.position.z),this.world.directionalLight.position.set(this.world.camera.position.x+110,this.world.camera.position.y+70,this.world.camera.position.z-20),this.state="playing"}else"playing"===this.state?(this.state="waiting",this.timer=ve):"waiting"===this.state&&(this.timer-=e,this.timer<=0&&(this.impulseTile(this.activeScenes[this.activeSceneIdx+1].initialTile),this.state="playing"))}this.animFrameId=window.requestAnimationFrame(this.tick)},getLookAtZ:function(){var t,e=null,i=Object(C["a"])(this.activeScene.group.children);try{for(i.s();!(t=i.n()).done;){var s=t.value;"ground"!==s.type&&"falling"===s.state&&((!e||s.fallingTimer>e.fallingTimer)&&(e=s))}}catch(a){i.e(a)}finally{i.f()}return e?e.getWorldPosition().z:null},createEntity:function(t,e,i,s){if(i!==D){var a;switch(e.type){case"ground":a=new wt({position:new k["I"](e.position.x,0,e.position.z),color:e.color,iMesh:this.world.imGrounds});break;case"tile":a=new Pt({position:new k["I"](e.position.x,A,e.position.z),angleY:e.rotation,color:e.color,iMesh:this.world.imTiles});break;case"ball":a=new Ct({position:new k["I"](e.position.x,F,e.position.z),color:e.color,iMesh:this.world.imBalls});break}if(i===j){if(s){var n=new k["d"](s.lastTileDef.color);a.color="#".concat(n.lerp(new k["d"](a.color),.5).getHexString())}t.initialTile=a}return t.group.addChild(a),a}t.lastTileDef=e},streamScene:function(t,e,i){for(var s=t.contentDef.length,a=t.streamingFrom,n=-1===e?s:Math.min(a+e,s),o=a;o<n;++o){var r=this.createEntity(t,t.contentDef[o],o,i);r&&(r.addToRenderWorld(),r.addToPhysicalWorld(this.world))}t.streamingFrom+=e,t.streamingFrom>=s&&(t.state="ready")},createScene:function(t,e,i){var s=JSON.parse(t.content),a={id:t.id,title:t.title,author:t.author,group:new bt,initialTile:null,state:i?"streaming":"ready"};if(i)a.contentDef=s,a.streamingFrom=0;else{var n,o=Object(C["a"])(s.entries());try{for(o.s();!(n=o.n()).done;){var r=Object(kt["a"])(n.value,2),l=r[0],c=r[1];this.createEntity(a,c,l,e)}}catch(f){o.e(f)}finally{o.f()}}var h,d,u=0;e&&(h=e.lastTileDef?e.lastTileDef.position.x:e.contentDef[D].position.x,d=a.initialTile?a.initialTile.position.x:a.contentDef[j].position.x,u=e.group.position.x+h-d);return a.group.setPosition(u,0,this.scenePositionZ),a},addNextSceneToWorld:function(t,e){var i=this.createScene(this.nextSceneDefs.shift(),this.activeScenes[this.activeScenes.length-1],e);e||(i.group.addToRenderWorld(),t&&i.group.addToPhysicalWorld(this.world)),this.world.group.addChild(i.group),this.activeScenes.push(i),this.scenePositionZ+=100,this.nextSceneDefs.length<=5&&this.fetchScenes(1)},impulseTile:function(t){t.body.isActive()||t.body.activate(),t.body.applyImpulse(new T.a.btVector3(0,0,R))}}},ge=be,we=(i("ed3f"),Object(h["a"])(ge,fe,pe,!1,null,"d273f610",null)),xe=we.exports;s["a"].use(f["a"]);var Ce=new f["a"]({routes:[{path:"/create",name:"create",component:ue},{path:"/view/:id",name:"viewScene",component:xe},{path:"/view",name:"view",component:xe},{path:"*",name:"home",component:g,meta:{title:"orejas"}}]});s["a"].config.productionTip=!1,s["a"].use(n["VueReCaptcha"],{siteKey:"6LfzhvoUAAAAANbKFJGEioyZkX6xIvo3ByxgHwSm",loaderOptions:{autoHideBadge:!0}}),s["a"].use(a["a"]),s["a"].http.options.root="https://dominos-party.ew.r.appspot.com/api/",s["a"].http.options.emulateJSON=!0,new s["a"]({router:Ce,render:function(t){return t(u)}}).$mount("#app")},"594a":function(t,e,i){},"5cf8":function(t,e,i){"use strict";var s=i("778c"),a=i.n(s);a.a},6518:function(t,e,i){"use strict";var s=i("d16d"),a=i.n(s);a.a},"65fe":function(t,e,i){"use strict";var s=i("3457"),a=i.n(s);a.a},"72b7":function(t,e,i){"use strict";var s=i("bd31"),a=i.n(s);a.a},"778c":function(t,e,i){},"7c18":function(t,e,i){"use strict";var s=i("594a"),a=i.n(s);a.a},a210:function(t,e,i){},a61f:function(t,e,i){},a9a4:function(t,e,i){},bc73:function(t,e,i){t.exports=i.p+"img/editor.8391daee.gif"},bd31:function(t,e,i){},cbbe:function(t,e,i){t.exports=i.p+"img/viewer.d9169a83.gif"},d16d:function(t,e,i){},e4b8:function(t,e,i){},ed3f:function(t,e,i){"use strict";var s=i("e4b8"),a=i.n(s);a.a},fffb7:function(t,e,i){"use strict";var s=i("a210"),a=i.n(s);a.a}});
//# sourceMappingURL=app.f25f0219.js.map